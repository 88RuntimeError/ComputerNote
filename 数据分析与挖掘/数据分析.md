# 一、Pandas

## 1. Pandas基础

- **Pandas能够处理的数据类型**
  - 与SQL或Excel表类似的数据
  - 有序或无需的时间序列数据
  - 带行列标签的矩阵数据
  - 任意其他形式的观测、统计数据

- **Pandas的优势**
  - 处理浮点与非浮点数据里的缺失数据，表示为NaN
  - 大小可变
  - 自动、显示数据对齐
  - 强大、灵活的分组统计功能
  - ......
  - 成熟的导入导出工具

## 2. Series对象

- Series对象是Pandas库中的一种数据结构，类似于一位数组
- 由一组数据以及与这组数据有关的标签（索引）组成
- Series对象可以存储整数、浮点数、字符串、Python对象等多种数据类型的数据
- 创建Series对象：pd.Series(data, index=index)

### 2.1 pd.Series(data=data, index=)

```python
import pandas as pd
data = ['李光地', '张红云', '王鹏']
s = pd.Series(data=data)
print(s)
print(type(s))

#result
0    李光地
1    张红云
2     王鹏
dtype: object
<class 'pandas.core.series.Series'>
```

```python
import pandas as pd
data = ['李光地', '张红云', '王鹏']
s = pd.Series(data=data, index=[1, 2, 3])
print(s)

#result
1    李光地
2    张红云
3     王鹏
dtype: object
```

```python
import pandas as pd
data = [90, 98, 87]
index = ['张三', '李四', '王五']
s = pd.Series(data=data, index=index)
print(s)

#result
张三    90
李四    98
王五    87
dtype: int64
```

### 2.2 Series的索引方式

#### 2.2.1 位置索引

- **索引范围[0, N-1]**

```python
import pandas as pd
data = ['李光地', '张红云', '王鹏']
s = pd.Series(data=data)
print(s[0])
print(s[1])

#result
李光地
张红云
```

#### 2.2.2 标签索引

- **获取单个标签索引值使用 [索引名称]**
- **获取多个标签索引值使用[ [索引名称1, 索引名称2, ...] ]**

```python
import pandas as pd
data = [90, 98, 87]
index = ['张三', '李四', '王五']
s = pd.Series(data=data, index=index)
print(s['张三'])
print('-'*30)
print(s[['张三', '王五']])

#result
90
------------------------------
张三    90
王五    87
dtype: int64
```

#### 2.2.3 切片索引

- **[start : stop : step]**
- **位置索引——含头不含尾**

```python
import pandas as pd
data = [90, 98, 87]
index = ['张三', '李四', '王五']
s = pd.Series(data=data, index=index)
print(s[0:2:1])

#result
张三    90
李四    98
dtype: int64
```

- **标签索引——含头也含尾**

```python
import pandas as pd
data = [90, 98, 87]
index = ['张三', '李四', '王五']
s = pd.Series(data=data, index=index)
print(s['张三':'王五'])
print('-'*50)
print(s['张三':'王五':2])

#result
张三    90
李四    98
王五    87
dtype: int64
--------------------------------------------------
张三    90
王五    87
dtype: int64
```

#### 2.2.4 获取Series的索引和值

- **获取索引 s.index**

- **获取值 s.values**

```python
import pandas as pd
data = [90, 98, 87]
index = ['张三', '李四', '王五']
s = pd.Series(data=data, index=index)
print(s.index)
print(list(s.index))
print('-'*50)
print(s.values)
print(type(s.values))

#result
Index(['张三', '李四', '王五'], dtype='object')
['张三', '李四', '王五']
--------------------------------------------------
[90 98 87]
<class 'numpy.ndarray'>
```

## 3.DataFrame对象

- DataFrame对象是Pandas库中的一种数据结构，类似于二维表，由行和列组成
- 与Series一样支持多种数据类型
- 创建DataFrame对象：pd.DataFrame(data, index, columns, dtype)

### 3.1 pd.DataFrame(data, index, columns, dtype)

- **列表方式创建DataFrame对象**

```python
import pandas as pd
data = [['小太阳', 320.9, 100], ['鼠标', 150.3, 50], ['小刀', 1.5, 200]]
columns = ['名称', '单价', '数量']
df = pd.DataFrame(data=data, columns=columns)
print(df)
print(type(df))

#result
    名称     单价   数量
0  小太阳  320.9  100
1   鼠标  150.3   50
2   小刀    1.5  200
<class 'pandas.core.frame.DataFrame'>
```

- **字典方式创建DataFrame对象**

```python
import pandas as pd
data = {
    '名称': ['小太阳', '鼠标', '小刀'],
    '单价': [320.9, 150.3, 1.5],
    '数量': [100, 50, 200],
    '公司': '东门超市'
}
df = pd.DataFrame(data=data)
print(df)

#result
    名称     单价   数量    公司
0  小太阳  320.9  100  东门超市
1   鼠标  150.3   50  东门超市
2   小刀    1.5  200  东门超市
```

### 3.2 DataFrame的重要属性

| 序号 | 属性        | 描述                                           |
| ---- | ----------- | ---------------------------------------------- |
| 1    | **values**  | 查看所有元素的值                               |
| 2    | **dtypes**  | 查看所有元素的类型                             |
| 3    | **index**   | 查看所有行名、重命名行名                       |
| 4    | **columns** | 查看所有列名、重命名列名                       |
| 5    | **T**       | 行列数据转换                                   |
| 6    | **head**    | 查看前N条数据，默认5条                         |
| 7    | **tail**    | 查看后N条数据，默认5条                         |
| 8    | **shape**   | 查看行数和列数。shape[0]表示行，shape[1]表示列 |
| 9    | **info**    | 查看索引、数据类型和内存信息                   |

```python
import pandas as pd
data = [['小太阳', 320.9, 100], ['鼠标', 150.3, 50], ['小刀', 1.5, 200]]
columns = ['名称', '单价', '数量']
df = pd.DataFrame(data=data, columns=columns)
print(df)
print('-'*15 + '查看所有元素的值:df.values' + '-'*15)
print(df.values)

print('-'*15 + '查看所有元素的类型:df.dtypes' + '-'*15)
print(df.dtypes)

print('-'*15 + '查看所有行名称:list(df.index)' + '-'*15)
print(list(df.index))

print('-'*15 + '修改行索引:df.index = [1, 2, 3]' + '-'*15)
df.index = [1, 2, 3]
print(df)

print('-'*15 + '查看列索引:df.columns' + '-'*15)
print(df.columns)

# 修改列索引
print('-'*15 + '修改列索引:df.columns =' + '-'*15)
df.columns = ['商品名称', '最新单价', '实时数量']
print(df)

print('-'*15 + '行列数据转换:df.T' + '-'*15)
# 规整格式
pd.set_option('display.unicode.east_asian_width', True)
new_df = df.T
print(new_df)

print('-'*15 + '查看前2条数据:df.head(2)' + '-'*15)
print(df.head(2))

print('-'*15 + '查看后2条数据:df.tail(2)' + '-'*15)
print(df.tail(2))

print('-'*10 + 'shape[0]表示行、shape[1]表示列' + '-'*10)
print(f'共{df.shape[0]}行', f'共{df.shape[1]}列')
print('-'*10 + '查看索引、数据类型、内存信息:df.info' + '-'*10)
print(df.info)

#result
    名称     单价   数量
0  小太阳  320.9  100
1   鼠标  150.3   50
2   小刀    1.5  200
---------------查看所有元素的值:df.values---------------
[['小太阳' 320.9 100]
 ['鼠标' 150.3 50]
 ['小刀' 1.5 200]]
---------------查看所有元素的类型:df.dtypes---------------
名称     object
单价    float64
数量      int64
dtype: object
---------------查看所有行名称:list(df.index)---------------
[0, 1, 2]
---------------修改行索引:df.index = [1, 2, 3]---------------
    名称     单价   数量
1  小太阳  320.9  100
2   鼠标  150.3   50
3   小刀    1.5  200
---------------查看列索引:df.columns---------------
Index(['名称', '单价', '数量'], dtype='object')
---------------修改列索引:df.columns =---------------
  商品名称   最新单价  实时数量
1  小太阳  320.9   100
2   鼠标  150.3    50
3   小刀    1.5   200
---------------行列数据转换:df.T---------------
               1      2     3
商品名称  小太阳   鼠标  小刀
最新单价   320.9  150.3   1.5
实时数量     100     50   200
---------------查看前2条数据:df.head(2)---------------
  商品名称  最新单价  实时数量
1   小太阳     320.9       100
2     鼠标     150.3        50
---------------查看后2条数据:df.tail(2)---------------
  商品名称  最新单价  实时数量
2     鼠标     150.3        50
3     小刀       1.5       200
----------shape[0]表示行、shape[1]表示列----------
共3行 共3列
----------查看索引、数据类型、内存信息:df.info----------
<bound method DataFrame.info of   商品名称  最新单价  实时数量
1   小太阳     320.9       100
2     鼠标     150.3        50
3     小刀       1.5       200>

Process finished with exit code 0
```

### 3.3 DataFrame的重要函数

| 序号 | 函数           | 描述                                  |
| ---- | -------------- | ------------------------------------- |
| 1    | **describe()** | 查看每列的统计汇总信息，DataFrame类型 |
| 2    | **count()**    | 返回每一列的非空值的个数              |
| 3    | **sum()**      | 返回每一列的和，无法计算返回空值      |
| 4    | **max()**      | 返回每一列的最大值                    |
| 5    | **min()**      | 返回每一列的最小值                    |

```python
import pandas as pd
data = [['sun', 320.9, 100], ['mouse', 150.3, 50], ['knife', 1.5, 200]]
columns = ['名称', '单价', '数量']
df = pd.DataFrame(data=data, columns=columns)
print(df)
print('-'*20 + 'df.describe()' + '-'*20)
print(df.describe())
print('-'*20 + 'df.count()' + '-'*20)
print(df.count())
print('-'*20 + 'df.sum()' + '-'*20)
print(df.sum())
print('-'*20 + 'df.max()' + '-'*20)
print(df.max())
print('-'*20 + 'df.min()' + '-'*20)
print(df.min())

#result
      名称     单价   数量
0    sun  320.9  100
1  mouse  150.3   50
2  knife    1.5  200
--------------------df.describe()--------------------
               单价          数量
count    3.000000    3.000000
mean   157.566667  116.666667
std    159.823945   76.376262
min      1.500000   50.000000
25%     75.900000   75.000000
50%    150.300000  100.000000
75%    235.600000  150.000000
max    320.900000  200.000000
--------------------df.count()--------------------
名称    3
单价    3
数量    3
dtype: int64
--------------------df.sum()--------------------
名称    sunmouseknife
单价            472.7
数量              350
dtype: object
--------------------df.max()--------------------
名称      sun
单价    320.9
数量      200
dtype: object
--------------------df.min()--------------------
名称    knife
单价      1.5
数量       50
dtype: object

Process finished with exit code 0
```

### 3.4 导入外部数据

#### 3.4.1 导入Excel数据

- **pd.read_excel(io, shheet_name, header)**
  - **io：**表示 .xls 和 .xlsx 文件路径或类文件对象
  - **sheet_name：**表示工作表，取值如下表所示
  - **header：**默认值为0，取第一行的值为列名，数据为除列名以外的数据，如果包含列名，则设置header=None

| 值                        | 说明                                                         |
| ------------------------- | ------------------------------------------------------------ |
| sheet_name=0              | 第一个Sheet页中的数据作为DataFrame对象                       |
| sheet_name=1              | 第二个Sheet页中的数据作为DataFrame对象                       |
| sheet_name='Sheet1'       | 名称为'Sheet1'的Sheet页中的数据作为DataFrame对象             |
| sheet_name=[0,1,'Sheet3'] | 第一个、第二个和名称为Sheet3的Sheet页中的数据作为DataFrame对象 |
| sheet_name=None           | 读取所有工作表                                               |

```python
import pandas as pd
df = pd.read_excel('./datas/Pandas/京东鞋子评论信息.xlsx', sheet_name='码数分析', header=None)
print(df)

#result
    0    1       2
0  42  148  77.89%
1  41   12   6.32%
2  44    6   3.16%
3  39    3   1.58%
4  43   13   6.84%
5  40    8   4.21%
```

```python
import pandas as pd
df = pd.read_excel('./datas/Pandas/02微机原理学员成绩统计.xlsx', sheet_name='02微机原理及格学员名单', usecols=[1])
print(df)

#result
     姓名
0    刘垒
1    于双
2    丁宁
3   高春艳
4    李帅
5    赵颖
6    张翠
7   仲光军
8   杨春岩
9    裴育
10  吴先智
```

```python
import pandas as pd
pd.set_option('display.unicode.east_asian_width', True)
df = pd.read_excel('./datas/Pandas/02微机原理学员成绩统计.xlsx', sheet_name='02微机原理及格学员名单', usecols=['姓名', '总成绩'])
print(df)

#result
      姓名  总成绩
0     刘垒      71
1     于双      69
2     丁宁      65
3   高春艳      67
4     李帅      73
5     赵颖      69
6     张翠      65
7   仲光军      61
8   杨春岩      62
9     裴育      64
10  吴先智      64
```

#### 3.4.2 导入CSV数据

- **pd.read_csv(filepath_or_buffer, sep=',', header, encoding=None)**
  - **filepath_or_buffer：**字符串、文件路径，也可以是URL链接
  - **sep：**指定作为列名的行，默认值为0，即取第一行的值为列名。数据为除列名以外的数据，若数据不包含列表，则设置header=None
  - **encoding：**字符串，默认值为None，文件编码格式

```python
import pandas as pd
df = pd.read_csv('./datas/Pandas/京东鞋子评论数据.csv', sep=',', encoding='gbk')
# head()默认为前5条数据
print(df.head())

#result
                               评论                   时间  颜色    尺码  Unnamed: 4
0                  外观颜值：很不错，颜值很高。  2020-05-14 14:32:58  黑色  41.0         NaN
1                   外观颜值：简约时尚，颜值高  2020-05-11 12:40:34  黑色  41.0         NaN
2                  舒适度：很好，很轻便，不挤脚  2020-04-25 13:41:45  黑色  41.0         NaN
3   总体来说不错，就是刚打开的时候味道有点呛，通风过之后就没了  2020-04-28 15:38:31  黑色  41.0         NaN
4  鞋子样式不错，就是鞋底太硬了&hellip;&hellip;  2020-04-09 14:06:30  灰色  41.0         NaN
```

#### 3.4.3 导入txt文件

- **pd.read_html(filepath_or_buffer, sep='\t', header, encoding=None)**



#### 3.4.4 导入HTML网页

- **pd.read_html(io, match='.+', flavor, header, endcoding)**
  - **io：**字符串、文件路径，也可以是URL链接，网址不接受https
  - **match：**正则表达式
  - **flavor：**解释器默认为'lxml'
  - **header：**指定列标题所在的行
  - **encoding：**文件的编码格式
  - 读取的数据为 <table\>标签内的数据

```python
import pandas as pd
url = 'http://www.espn.com/nba/salaries'
df = pd.DataFrame()
df = df.append(pd.read_html(url, header=0))
print(df)

# 保存为CSV文件
df.to_csv('nbasalary.csv', index=False)

#result
 RK                       NAME                    TEAM       SALARY
0    1          Stephen Curry, PG   Golden State Warriors  $45,780,966
1    2           James Harden, SG      Philadelphia 76ers  $44,310,840
2    3              John Wall, PG         Houston Rockets  $44,310,840
3    4      Russell Westbrook, PG      Los Angeles Lakers  $44,211,146
4    5           Kevin Durant, PF           Brooklyn Nets  $42,018,900
5    6           LeBron James, SF      Los Angeles Lakers  $41,180,544
6    7  Giannis Antetokounmpo, PF         Milwaukee Bucks  $39,344,970
7    8         Damian Lillard, PG  Portland Trail Blazers  $39,344,900
8    9          Kawhi Leonard, SF             LA Clippers  $39,344,900
9   10            Paul George, SG             LA Clippers  $39,344,900
10  RK                       NAME                    TEAM       SALARY
11  11          Klay Thompson, SG   Golden State Warriors  $37,980,720
12  12           Jimmy Butler, SF              Miami Heat  $36,016,200
13  13          Tobias Harris, PF      Philadelphia 76ers  $35,995,950
14  14        Khris Middleton, SF         Milwaukee Bucks  $35,500,000
15  15          Anthony Davis, PF      Los Angeles Lakers  $35,361,360
16  16             Rudy Gobert, C               Utah Jazz  $35,344,828
17  17           Kyrie Irving, PG           Brooklyn Nets  $35,328,700
18  18           Bradley Beal, SG      Washington Wizards  $33,724,200
19  19          Pascal Siakam, PF         Toronto Raptors  $33,003,936
20  20            Ben Simmons, PG           Brooklyn Nets  $33,003,936
```

### 3.5 数据提取

#### 3.5.1 按行提取数据

```python
import pandas as pd
pd.set_option('display.unicode.east_asian_width', True)
data = [[45, 65, 100], [56, 45, 50], [67, 67, 76]]
index = ['张三', '李四', '王五']
columns = ['数学', '语文', '英语']
df = pd.DataFrame(data=data, index=index, columns=columns)
print(df)

# 提取行数据
print('-'*15 + "按行索引名称提取：df.loc['张三']" + '-'*15)
print(df.loc['张三'])

print('-'*15 + "按行索引编号提取：df.iloc[0]" + '-'*15)
print(df.iloc[0])

print('-'*15 + "提取多行数据：df.loc[ ['张三','王五'] ]" + '-'*15)
print(df.loc[['张三', '王五']])

print('-'*15 + "提取多行数据：df.iloc[ [0, 2] ]" + '-'*15)
print(df.iloc[[0, 2]])

#result
      数学  语文  英语
张三    45    65   100
李四    56    45    50
王五    67    67    76
---------------按行索引名称提取：df.loc['张三']---------------
数学     45
语文     65
英语    100
Name: 张三, dtype: int64
---------------按行索引编号提取：df.iloc[0]---------------
数学     45
语文     65
英语    100
Name: 张三, dtype: int64
---------------提取多行数据：df.loc[ ['张三','王五'] ]---------------
      数学  语文  英语
张三    45    65   100
王五    67    67    76
---------------提取多行数据：df.iloc[ [0, 2] ]---------------
      数学  语文  英语
张三    45    65   100
王五    67    67    76
```

#### 3.5.2 按列提取数据

```python
import pandas as pd
pd.set_option('display.unicode.east_asian_width', True)
data = [[45, 65, 100], [56, 45, 50], [67, 67, 76]]
index = ['张三', '李四', '王五']
columns = ['数学', '语文', '英语']
df = pd.DataFrame(data=data, index=index, columns=columns)
print(df)

print('-'*15 + "按列名提取：df[ ['数学', '英语'] ]" + '-'*15)
print(df[['数学', '英语']])

print('-'*15 + "df.loc[ :, ['数学', '英语'] ]" + '-'*15)
print("df.loc[ :, ['数学', '英语'] ]", '逗号左边代表行，逗号右边代表列')
print(df.loc[ :, ['数学', '英语'] ])

print('-'*15 + "df.iloc[ :, [0, 2] ]" + '-'*15)
print("df.iloc[ :, [0, 2] ]", '逗号左边代表行，逗号右边代表列')
print(df.iloc[ :, [0, 2] ])

#result
      数学  语文  英语
张三    45    65   100
李四    56    45    50
王五    67    67    76
---------------按列名提取：df[ ['数学', '英语'] ]---------------
      数学  英语
张三    45   100
李四    56    50
王五    67    76
---------------df.loc[ :, ['数学', '英语'] ]---------------
df.loc[ :, ['数学', '英语'] ] 逗号左边代表行，逗号右边代表列
      数学  英语
张三    45   100
李四    56    50
王五    67    76
---------------df.iloc[ :, [0, 2] ]---------------
df.iloc[ :, [0, 2] ] 逗号左边代表行，逗号右边代表列
      数学  英语
张三    45   100
李四    56    50
王五    67    76
```

#### 3.5.3 按区域提取数据

```python
import pandas as pd
pd.set_option('display.unicode.east_asian_width', True)
data = [[45, 65, 100], [56, 45, 50], [67, 67, 76]]
index = ['张三', '李四', '王五']
columns = ['数学', '语文', '英语']
df = pd.DataFrame(data=data, index=index, columns=columns)
print(df)

print('-'*10 + "print(df.loc['张三', '数学'])" + '-'*10)
print(df.loc['张三', '数学'])
print(type(df.loc['张三', '数学']))

print('-'*10 + "print(df.loc[['张三', '王五'], ['数学', '语文']])" + '-'*10)
print(df.loc[['张三', '王五'], ['数学', '语文']])
print(type(df.loc[['张三', '王五'], ['数学', '语文']]))

print('-'*15 + "第0行，第0列：df.iloc[0,0]" + '-'*15)
print(df.iloc[0, 0])

print('-'*15 + "df.iloc[0:2, 0:2]" + '-'*15)
print("第0行到第1行，第0列到第1列")
print(df.iloc[0:2, 0:2])

print('-'*15 + "df.iloc[[0, 2], [0, 2]]" + '-'*15)
print("第0行和第2行，第0列和第2列")
print(df.iloc[[0, 2], [0, 2]])

print('-'*15 + "df.iloc[:, 0]" + '-'*15)
print("提取所有行的第0列")
print(df.iloc[:, 0])

#result
      数学  语文  英语
张三    45    65   100
李四    56    45    50
王五    67    67    76
----------print(df.loc['张三', '数学'])----------
45
<class 'numpy.int64'>
----------print(df.loc[['张三', '王五'], ['数学', '语文']])----------
      数学  语文
张三    45    65
王五    67    67
<class 'pandas.core.frame.DataFrame'>
---------------第0行，第0列：df.iloc[0,0]---------------
45
---------------df.iloc[0:2, 0:2]---------------
第0行到第1行，第0列到第1列
      数学  语文
张三    45    65
李四    56    45
---------------df.iloc[[0, 2], [0, 2]]---------------
第0行和第2行，第0列和第2列
      数学  英语
张三    45   100
王五    67    76
---------------df.iloc[:, 0]---------------
提取所有行的第0列
张三    45
李四    56
王五    67
Name: 数学, dtype: int64

Process finished with exit code 0
```

#### 3.5.4 按条件提取

```python
import pandas as pd
pd.set_option('display.unicode.east_asian_width', True)
data = [[45, 65, 100], [56, 45, 50], [67, 67, 76]]
index = ['张三', '李四', '王五']
columns = ['数学', '语文', '英语']
df = pd.DataFrame(data=data, index=index, columns=columns)
print(df)

print('-'*15 + '提取数学成绩小于60的数据' + '-'*15)
print('-'*15 + "df['数学'] < 60" + '-'*15)
print(df['数学'] < 60)

print('-'*15 + "df[df['数学']<60]" + '-'*15)
print(df[df['数学']<60])

print('-'*15 + "df[df['数学']<60].index[0]" + '-'*15)
print(df[df['数学']<60].index[0])

print('-'*15 + "df[df['数学']<60].index[1]" + '-'*15)
print(df[df['数学']<60].index[1])

#result
      数学  语文  英语
张三    45    65   100
李四    56    45    50
王五    67    67    76
---------------提取数学成绩小于60的数据---------------
---------------df['数学'] < 60---------------
张三     True
李四     True
王五    False
Name: 数学, dtype: bool
---------------df[df['数学']<60]---------------
      数学  语文  英语
张三    45    65   100
李四    56    45    50
---------------df[df['数学']<60].index[0]---------------
张三
---------------df[df['数学']<60].index[1]---------------
李四

Process finished with exit code 0
```



### 3.6 DataFrame对象数据的增加、修改和删除

#### 3.6.1 增加数据

##### 3.6.1.1 按列增加数据

```python
import pandas as pd
pd.set_option('display.unicode.east_asian_width', True)
data = [[45, 65, 100], [56, 45, 50], [67, 67, 76]]
index = ['张三', '李四', '王五']
columns = ['数学', '语文', '英语']
df = pd.DataFrame(data=data, index=index, columns=columns)
print(df)

print('-'*10 + '采用直接赋值的方式' + '-'*10)
print('-'*10 + "df['政治'] = [90, 89, 100]" + '-'*10)
df['政治'] = [90, 89, 100]
print(df)

print('-'*10 + '采用loc属性在最后一列增加数据' + '-'*10)
print('-'*10 + "df.loc[:, '化学'] = [100, 30, 98]" + '-'*10)
df.loc[:, '化学'] = [100, 30, 98]
print(df)

print('-'*10 + '在指定位置插入一列数据' + '-'*10)
print('-'*10 + "df.insert(1, '历史', lis)" + '-'*10)
lis = [100, 90, 99]
df.insert(1, '历史', lis)
print(df)

#result
      数学  语文  英语
张三    45    65   100
李四    56    45    50
王五    67    67    76
----------采用直接赋值的方式----------
----------df['政治'] = [90, 89, 100]----------
      数学  语文  英语  政治
张三    45    65   100    90
李四    56    45    50    89
王五    67    67    76   100
----------采用loc属性在最后一列增加数据----------
----------df.loc[:, '化学'] = [100, 30, 98]----------
      数学  语文  英语  政治  化学
张三    45    65   100    90   100
李四    56    45    50    89    30
王五    67    67    76   100    98
----------在指定位置插入一列数据----------
----------df.insert(1, '历史', lis)----------
      数学  历史  语文  英语  政治  化学
张三    45   100    65   100    90   100
李四    56    90    45    50    89    30
王五    67    99    67    76   100    98

Process finished with exit code 0
```

##### 3.6.1.2 按行增加数据

```python
import pandas as pd
pd.set_option('display.unicode.east_asian_width', True)
data = [[45, 65, 100], [56, 45, 50], [67, 67, 76]]
index = ['张三', '李四', '王五']
columns = ['数学', '语文', '英语']
df = pd.DataFrame(data=data, index=index, columns=columns)
print(df)

print('-'*10 + '采用loc属性在最后一行增加数据' + '-'*10)
print('-'*10 + "df.loc['赵六'] = [56, 67, 90]" + '-'*10)
df.loc['赵六'] = [56, 67, 90]
print(df)

new_df = pd.DataFrame(
    data = {'数学': [67, 69], '语文': [56, 78], '英语': [100, 99]},
    index = ['张丽丽', '张伟']
)
print('-'*10 + '新建一个new_df' + '-'*10)
print(new_df)
print('-'*10 + '将new_df对象添加到原表中' + '-'*10)
print('-'*10 + 'df = df.append(new_df)' + '-'*10)
df = df.append(new_df)
print(df)

#result
      数学  语文  英语
张三    45    65   100
李四    56    45    50
王五    67    67    76
----------采用loc属性在最后一行增加数据----------
----------df.loc['赵六'] = [56, 67, 90]----------
      数学  语文  英语
张三    45    65   100
李四    56    45    50
王五    67    67    76
赵六    56    67    90
----------新建一个new_df----------
        数学  语文  英语
张丽丽    67    56   100
张伟      69    78    99
----------将new_df对象添加到原表中----------
----------df = df.append(new_df)----------
        数学  语文  英语
张三      45    65   100
李四      56    45    50
王五      67    67    76
赵六      56    67    90
张丽丽    67    56   100
张伟      69    78    99

Process finished with exit code 0
```

#### 3.6.2 修改数据

##### 3.6.2.1 修改列标题

```python
import pandas as pd
pd.set_option('display.unicode.east_asian_width', True)
data = [[45, 65, 100], [56, 45, 50], [67, 67, 76]]
index = ['张三', '李四', '王五']
columns = ['数学', '语文', '英语']
df = pd.DataFrame(data=data, index=index, columns=columns)
print(df)

print('-'*15 + '直接修改列标题' + '-'*15)
print('-'*5 + "df.columns = ['数学（上）', '语文（上）', '英语（上）']" + '-'*5)
df.columns = ['数学（上）', '语文（上）', '英语（上）']
print(df)

print('-'*15 + '使用rename属性进行修改' + '-'*15)
print('--'+ "df.rename(columns={'数学（上）': '数学（下）', '语文（上）': '语文（下）', '英语（上）': '英语（下）'})" + '--')
df.rename(columns={'数学（上）': '数学（下）', '语文（上）': '语文（下）', '英语（上）': '英语（下）'})
print(df)

#result
      数学  语文  英语
张三    45    65   100
李四    56    45    50
王五    67    67    76
---------------直接修改列标题---------------
-----df.columns = ['数学（上）', '语文（上）', '英语（上）']-----
      数学（上）  语文（上）  英语（上）
张三          45          65         100
李四          56          45          50
王五          67          67          76
---------------使用rename属性进行修改---------------
--df.rename(columns={'数学（上）': '数学（下）', '语文（上）': '语文（下）', '英语（上）': '英语（下）'})--
      数学（上）  语文（上）  英语（上）
张三          45          65         100
李四          56          45          50
王五          67          67          76

Process finished with exit code 0
```

##### 3.6.2.2 修改行标题

```python
import pandas as pd
pd.set_option('display.unicode.east_asian_width', True)
data = [[45, 65, 100], [56, 45, 50], [67, 67, 76]]
index = ['张三', '李四', '王五']
columns = ['数学', '语文', '英语']
df = pd.DataFrame(data=data, index=index, columns=columns)
print(df)

print('-'*15 + '采用直接赋值的形式' + '-'*15)
print('-'*15 + "df.index = list('123')" + '-'*15)
df.index = list('123')
print(df)

print('-'*15 + '使用rename属性进行修改' + '-'*15)
print('--'+ "df.rename({'1': '一', '2': '二', '3': '三'}, inplace=True, axis=0)" + '--')
print('axis=0表示修改行, axis=1表示修改列, 默认修改行')
df.rename({'1': '一', '2': '二', '3': '三'}, inplace=True, axis=0)
print(df)

#result
      数学  语文  英语
张三    45    65   100
李四    56    45    50
王五    67    67    76
---------------采用直接赋值的形式---------------
---------------df.index = list('123')---------------
   数学  语文  英语
1    45    65   100
2    56    45    50
3    67    67    76
---------------使用rename属性进行修改---------------
--df.rename({'1': '一', '2': '二', '3': '三'}, inplace=True, axis=0)--
axis=0表示修改行, axis=1表示修改列, 默认修改行
    数学  语文  英语
一    45    65   100
二    56    45    50
三    67    67    76

Process finished with exit code 0
```

##### 3.6.2.3 修改行数据

```python
import pandas as pd
pd.set_option('display.unicode.east_asian_width', True)
data = [[45, 65, 100], [56, 45, 50], [67, 67, 76]]
index = ['张三', '李四', '王五']
columns = ['数学', '语文', '英语']
df = pd.DataFrame(data=data, index=index, columns=columns)
print(df)

print('-'*15 + '修改一整行数据' + '-'*15)
print('-----' + "df.loc['张三'] = [100, 100, 120]" + '-----')
df.loc['张三'] = [100, 100, 120]
print(df)

print('-'*15 + '修改第0行所有的数据' + '-'*15)
print('-'*5 + 'df.iloc[0,:] = [90, 90, 90]' + '-'*5)
df.iloc[0, :] = [90, 90, 90]
print(df)

#result
      数学  语文  英语
张三    45    65   100
李四    56    45    50
王五    67    67    76
---------------修改一整行数据---------------
-----df.loc['张三'] = [100, 100, 120]-----
      数学  语文  英语
张三   100   100   120
李四    56    45    50
王五    67    67    76
---------------修改第0行所有的列---------------
-----df.iloc[0, :] = [90, 90, 90]-----
      数学  语文  英语
张三    90    90    90
李四    56    45    50
王五    67    67    76

Process finished with exit code 0
```

##### 3.6.2.4 修改列数据

```python
import pandas as pd
pd.set_option('display.unicode.east_asian_width', True)
data = [[45, 65, 100], [56, 45, 50], [67, 67, 76]]
index = ['张三', '李四', '王五']
columns = ['数学', '语文', '英语']
df = pd.DataFrame(data=data, index=index, columns=columns)
print(df)

print('-'*15 + '修改一整列数据' + '-'*15)
print('-----' + "df.loc[:, '数学'] = [100, 100, 100]" + '-----')
df.loc[:, '数学'] = [100, 100, 100]
print(df)

print('-'*15 + '修改第0列所有的数据' + '-'*15)
print('-'*5 + 'df.iloc[:,0] = 90' + '-'*5)
df.iloc[:, 0] = 90
print(df)

#result
      数学  语文  英语
张三    45    65   100
李四    56    45    50
王五    67    67    76
---------------修改一整列数据---------------
-----df.loc[:, '数学'] = [100, 100, 100]-----
      数学  语文  英语
张三   100    65   100
李四   100    45    50
王五   100    67    76
---------------修改第0列所有的数据---------------
-----df.iloc[:,0] = 90-----
      数学  语文  英语
张三    90    65   100
李四    90    45    50
王五    90    67    76

Process finished with exit code 0
```

##### 3.6.2.5 修改某一处数据

```python
import pandas as pd
pd.set_option('display.unicode.east_asian_width', True)
data = [[45, 65, 100], [56, 45, 50], [67, 67, 76]]
index = ['张三', '李四', '王五']
columns = ['数学', '语文', '英语']
df = pd.DataFrame(data=data, index=index, columns=columns)
print(df)

print("-------df.loc['李四', '语文'] = 250-------")
df.loc['李四', '语文'] = 250
print(df)
print("-------df.iloc[1, 1] = 300-------")
df.iloc[1, 1] = 300
print(df)

#result
      数学  语文  英语
张三    45    65   100
李四    56    45    50
王五    67    67    76
-------df.loc['李四', '语文'] = 250-------
      数学  语文  英语
张三    45    65   100
李四    56   250    50
王五    67    67    76
-------df.iloc[1, 1] = 300-------
      数学  语文  英语
张三    45    65   100
李四    56   300    50
王五    67    67    76

Process finished with exit code 0
```

#### 3.6.3 删除数据

- **df.drop(labels=None, axis=0, index=None, columns=None, inplace=False)**

  - **labels：**表示行标签或列标签

  - **axis：**axis=0表示按行删除

    ​           axis=1表示按列删除

  - **index：**删除行，默认值为None
  - **columns：**删除列，默认值为None
  - **inplace：**对原数组作出修改并返回一个新数组，默认值为False，如果值为True，那么原数组直接就将被替换

##### 3.6.3.1 删除列数据

```python
import pandas as pd
pd.set_option('display.unicode.east_asian_width', True)
data = [[45, 65, 100], [56, 45, 50], [67, 67, 76]]
index = ['张三', '李四', '王五']
columns = ['数学', '语文', '英语']
df = pd.DataFrame(data=data, index=index, columns=columns)
print(df)

print('-'*15 + "删除某列数据" + '-'*15)
print("-------df.drop(['数学'], axis=1, inplace=True)-------")
df.drop(['数学'], axis=1, inplace=True)
print(df)


print("-------df.drop(columns='语文', inplace=True)-------")
df.drop(columns='语文', inplace=True)
print(df)

print("-------df.drop(label='英语', axis=1, inplace=True)-------")
df.drop(labels='英语', axis=1, inplace=True)
print(df)

#result
      数学  语文  英语
张三    45    65   100
李四    56    45    50
王五    67    67    76
---------------删除某列数据---------------
-------df.drop(['数学'], axis=1, inplace=True)-------
      语文  英语
张三    65   100
李四    45    50
王五    67    76
-------df.drop(columns='语文', inplace=True)-------
      英语
张三   100
李四    50
王五    76
-------df.drop(label='英语', axis=1, inplace=True)-------
Empty DataFrame
Columns: []
Index: [张三, 李四, 王五]

Process finished with exit code 0
```

##### 3.5.3.2 删除行数据

```python
import pandas as pd
pd.set_option('display.unicode.east_asian_width', True)
data = [[45, 65, 100], [56, 45, 50], [67, 67, 76]]
index = ['张三', '李四', '王五']
columns = ['数学', '语文', '英语']
df = pd.DataFrame(data=data, index=index, columns=columns)
print(df)

print('-'*15 + "删除某行数据" + '-'*15)
print("-------df.drop(['张三'], axis=0, inplace=True)-------")
df.drop(['张三'], axis=0, inplace=True)
print(df)


print("-------df.drop(columns='语文', inplace=True)-------")
df.drop(index='李四', inplace=True)
print(df)

print("-------df.drop(label='英语', axis=1, inplace=True)-------")
df.drop(labels='王五', axis=0, inplace=True)
print(df)

#result
      数学  语文  英语
张三    45    65   100
李四    56    45    50
王五    67    67    76
---------------删除某行数据---------------
-------df.drop(['张三'], axis=0, inplace=True)-------
      数学  语文  英语
李四    56    45    50
王五    67    67    76
-------df.drop(columns='语文', inplace=True)-------
      数学  语文  英语
王五    67    67    76
-------df.drop(label='英语', axis=1, inplace=True)-------
Empty DataFrame
Columns: [数学, 语文, 英语]
Index: []

Process finished with exit code 0
```

##### 3.5.3.3 按条件删除

```python
import pandas as pd

pd.set_option('display.unicode.east_asian_width', True)
data = [[45, 65, 100], [56, 45, 50], [67, 67, 76]]
index = ['张三', '李四', '王五']
columns = ['数学', '语文', '英语']
df = pd.DataFrame(data=data, index=index, columns=columns)
print(df)

print('-'*15 + '删除数学成绩小于60的数据' + '-'*15)
print('-'*15 + "df[df['数学']<60]" + '-'*15)
print(df[df['数学'] < 60])

print("---df.drop(df[df['数学'] < 60].index[1], inplace=True)---")
print("------删掉数学成绩小于60的DataFrame数据中，索引为1的数据------")
df.drop(df[df['数学'] < 60].index[1], inplace=True)
print(df)

print("---df.drop(df[df['数学'] < 60].index[:], inplace=True)---")
print("-----------删掉所有数学成绩小于60-----------")
df.drop(df[df['数学'] < 60].index[:], inplace=True)
print(df)

#result
      数学  语文  英语
张三    45    65   100
李四    56    45    50
王五    67    67    76
---------------删除数学成绩小于60的数据---------------
---------------df[df['数学']<60]---------------
      数学  语文  英语
张三    45    65   100
李四    56    45    50
---df.drop(df[df['数学'] < 60].index[1], inplace=True)---
------删掉数学成绩小于60的DataFrame数据中，索引为1的数据------
      数学  语文  英语
张三    45    65   100
王五    67    67    76
---df.drop(df[df['数学'] < 60].index[:], inplace=True)---
-----------删掉所有数学成绩小于60-----------
      数学  语文  英语
王五    67    67    76

Process finished with exit code 0 
```

## 4. 数据清洗

- **查看缺失值**
  - 使用 **DataFrame** 对象的 **info()** 方法
- **判断数据是否存在缺失值**
  - 使用 **DataFrame** 的 **isnull()** 方法和 **notnull()** 方法
- **缺失值的处理方式**
  - 不处理
  - 删除
  - 填充或替换
  - 插值(均值、中位数、众数等)

- **重复值处理**
  - 删除

#### 4.1 查看缺失值

```python
import pandas as pd
pd.set_option('display.unicode.east_asian.width', True)
df = pd.read_excel('./datas/msb课程记录.xls')
print(df)
print('-'*15 + 'df.info()' + '-'*15)
print('-'*15 + '查看是否有缺失值' + '-'*15)
print(df.info())

print('-'*15 + 'df.isnull()' + '-'*15)
print('判断缺失值，结果为True或False，不为NaN时为False，出现True说明有NaN')
print(df.isnull())

print('-'*15 + 'df.notnull()' + '-'*15)
print('判断缺失值，结果为True或False，不为NaN时为True，出现False说明有NaN')
print(df.notnull())

#result
   买家会员名  买家实际支付金额  ...  类别        订单付款时间
0      msb001          30960.00  ...  课程 2020-10-09 22:54:26
1      msb002              1.00  ...   NaN 2020-10-09 22:52:42
2      msb003           9980.00  ...  课程 2020-01-19 12:53:01
3      msb004           9980.00  ...  课程 2020-06-30 11:46:14
4      msb005              9.90  ...   NaN 2020-03-23 18:25:45
5      msb006              0.02  ...  课程 2020-03-24 19:25:45
6      msb007           2400.00  ...  课程 2020-03-25 11:00:45
7      msb008              1.00  ...  课程 2020-03-26 23:11:11
8      msb009           2980.00  ...  课程 2020-03-27 07:25:30
9      msb010           1980.00  ...  课程 2020-03-28 18:09:12
10     msb010           1980.00  ...  课程 2020-03-28 18:09:12

[11 rows x 6 columns]
---------------df.info()---------------
---------------查看是否有缺失值---------------
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 11 entries, 0 to 10
Data columns (total 6 columns):
 #   Column    Non-Null Count  Dtype         
---  ------    --------------  -----         
 0   买家会员名     11 non-null     object        
 1   买家实际支付金额  11 non-null     float64       
 2   课程总数量     9 non-null      float64       
 3   课程标题      11 non-null     object        
 4   类别        9 non-null      object        
 5   订单付款时间    11 non-null     datetime64[ns]
dtypes: datetime64[ns](1), float64(2), object(3)
memory usage: 656.0+ bytes
None
---------------df.isnull()---------------
判断缺失值，结果为True或False，不为NaN时为False，出现True说明有NaN
    买家会员名  买家实际支付金额  课程总数量  课程标题    类别  订单付款时间
0        False             False       False      False  False         False
1        False             False       False      False   True         False
2        False             False       False      False  False         False
3        False             False        True      False  False         False
4        False             False       False      False   True         False
5        False             False       False      False  False         False
6        False             False       False      False  False         False
7        False             False        True      False  False         False
8        False             False       False      False  False         False
9        False             False       False      False  False         False
10       False             False       False      False  False         False
---------------df.notnull()---------------
判断缺失值，结果为True或False，不为NaN时为True，出现False说明有NaN
    买家会员名  买家实际支付金额  课程总数量  课程标题    类别  订单付款时间
0         True              True        True       True   True          True
1         True              True        True       True  False          True
2         True              True        True       True   True          True
3         True              True       False       True   True          True
4         True              True        True       True  False          True
5         True              True        True       True   True          True
6         True              True        True       True   True          True
7         True              True       False       True   True          True
8         True              True        True       True   True          True
9         True              True        True       True   True          True
10        True              True        True       True   True          True

Process finished with exit code 0
```

#### 4.2 删除缺失值

```python
import pandas as pd
pd.set_option('display.unicode.east_asian.width', True)
df = pd.read_excel('./datas/msb课程记录.xls')
print(df)
print('-'*15 + 'df.dropna()' + '-'*15)
print('-'*10 + '删除所有含NaN项的数据' + '-'*10)
df1 = df.dropna()
print(df1)

print('-'*15 + 'df.dropna()' + '-'*15)
print('-'*10 + '删除指定列中含NaN项的数据' + '-'*10)
df2 = df[df['课程总数量'].notnull()]
print(df2)

#result
   买家会员名  买家实际支付金额  ...  类别        订单付款时间
0      msb001          30960.00  ...  课程 2020-10-09 22:54:26
1      msb002              1.00  ...   NaN 2020-10-09 22:52:42
2      msb003           9980.00  ...  课程 2020-01-19 12:53:01
3      msb004           9980.00  ...  课程 2020-06-30 11:46:14
4      msb005              9.90  ...   NaN 2020-03-23 18:25:45
5      msb006              0.02  ...  课程 2020-03-24 19:25:45
6      msb007           2400.00  ...  课程 2020-03-25 11:00:45
7      msb008              1.00  ...  课程 2020-03-26 23:11:11
8      msb009           2980.00  ...  课程 2020-03-27 07:25:30
9      msb010           1980.00  ...  课程 2020-03-28 18:09:12
10     msb010           1980.00  ...  课程 2020-03-28 18:09:12

[11 rows x 6 columns]
---------------df.dropna()---------------
----------删除所有含NaN项的数据----------
   买家会员名  买家实际支付金额  ...  类别        订单付款时间
0      msb001          30960.00  ...  课程 2020-10-09 22:54:26
2      msb003           9980.00  ...  课程 2020-01-19 12:53:01
5      msb006              0.02  ...  课程 2020-03-24 19:25:45
6      msb007           2400.00  ...  课程 2020-03-25 11:00:45
8      msb009           2980.00  ...  课程 2020-03-27 07:25:30
9      msb010           1980.00  ...  课程 2020-03-28 18:09:12
10     msb010           1980.00  ...  课程 2020-03-28 18:09:12

[7 rows x 6 columns]
---------------df.dropna()---------------
----------删除指定列中含NaN项的数据----------
   买家会员名  买家实际支付金额  ...  类别        订单付款时间
0      msb001          30960.00  ...  课程 2020-10-09 22:54:26
1      msb002              1.00  ...   NaN 2020-10-09 22:52:42
2      msb003           9980.00  ...  课程 2020-01-19 12:53:01
4      msb005              9.90  ...   NaN 2020-03-23 18:25:45
5      msb006              0.02  ...  课程 2020-03-24 19:25:45
6      msb007           2400.00  ...  课程 2020-03-25 11:00:45
8      msb009           2980.00  ...  课程 2020-03-27 07:25:30
9      msb010           1980.00  ...  课程 2020-03-28 18:09:12
10     msb010           1980.00  ...  课程 2020-03-28 18:09:12

[9 rows x 6 columns]

Process finished with exit code 0
```

#### 4.3 填充缺失值

```python
import pandas as pd
pd.set_option('display.unicode.east_asian.width', True)
df = pd.read_excel('./datas/msb课程记录.xls')
print(df)
print('-'*15 + 'df.fillna(0)' + '-'*15)
print('-'*10 + '用0填充缺失值' + '-'*10)
df['课程总数量'] = df['课程总数量'].fillna(0)
print(df)

#result
   买家会员名  买家实际支付金额  ...  类别        订单付款时间
0      msb001          30960.00  ...  课程 2020-10-09 22:54:26
1      msb002              1.00  ...   NaN 2020-10-09 22:52:42
2      msb003           9980.00  ...  课程 2020-01-19 12:53:01
3      msb004           9980.00  ...  课程 2020-06-30 11:46:14
4      msb005              9.90  ...   NaN 2020-03-23 18:25:45
5      msb006              0.02  ...  课程 2020-03-24 19:25:45
6      msb007           2400.00  ...  课程 2020-03-25 11:00:45
7      msb008              1.00  ...  课程 2020-03-26 23:11:11
8      msb009           2980.00  ...  课程 2020-03-27 07:25:30
9      msb010           1980.00  ...  课程 2020-03-28 18:09:12
10     msb010           1980.00  ...  课程 2020-03-28 18:09:12

[11 rows x 6 columns]
---------------df.fillna(0)---------------
----------用0填充缺失值----------
   买家会员名  买家实际支付金额  ...  类别        订单付款时间
0      msb001          30960.00  ...  课程 2020-10-09 22:54:26
1      msb002              1.00  ...   NaN 2020-10-09 22:52:42
2      msb003           9980.00  ...  课程 2020-01-19 12:53:01
3      msb004           9980.00  ...  课程 2020-06-30 11:46:14
4      msb005              9.90  ...   NaN 2020-03-23 18:25:45
5      msb006              0.02  ...  课程 2020-03-24 19:25:45
6      msb007           2400.00  ...  课程 2020-03-25 11:00:45
7      msb008              1.00  ...  课程 2020-03-26 23:11:11
8      msb009           2980.00  ...  课程 2020-03-27 07:25:30
9      msb010           1980.00  ...  课程 2020-03-28 18:09:12
10     msb010           1980.00  ...  课程 2020-03-28 18:09:12

[11 rows x 6 columns]

Process finished with exit code 0
```

#### 4.4 重复值处理

```python
import pandas as pd
pd.set_option('display.unicode.east_asian.width', True)
df = pd.read_excel('./datas/msb课程记录.xls')
print(df)
print('-'*15 + 'print(df.duplicated())' + '-'*15)
print('-'*10 + '查找是否有重复值(完全一样的行)' + '-'*10)
print(df.duplicated())

print('-'*15 + 'df1 = df.drop_duplicates()' + '-'*15)
print('-'*10 + '删除所有完全重复的数据' + '-'*10)
df1 = df.drop_duplicates()
print(df1)

print('-'*15 + "df2 = df.drop_duplicates(['买家实际支付金额'])" + '-'*15)
print('-'*10 + '删除指定列的重复数据' + '-'*10)
df2 = df.drop_duplicates(['买家实际支付金额'])
print(df2)

print('-'*10 + "df3 = df.drop_duplicates(['买家实际支付金额'], keep='last')" + '-'*10)
print('-'*10 + '保留重复行的最后一行，默认保留重复行的第一行' + '-'*10)
df3 = df.drop_duplicates(['买家实际支付金额'], keep='last')
print(df3)

#result
   买家会员名  买家实际支付金额  ...  类别        订单付款时间
0      msb001          30960.00  ...  课程 2020-10-09 22:54:26
1      msb002              1.00  ...   NaN 2020-10-09 22:52:42
2      msb003           9980.00  ...  课程 2020-01-19 12:53:01
3      msb004           9980.00  ...  课程 2020-06-30 11:46:14
4      msb005              9.90  ...   NaN 2020-03-23 18:25:45
5      msb006              0.02  ...  课程 2020-03-24 19:25:45
6      msb007           2400.00  ...  课程 2020-03-25 11:00:45
7      msb008              1.00  ...  课程 2020-03-26 23:11:11
8      msb009           2980.00  ...  课程 2020-03-27 07:25:30
9      msb010           1980.00  ...  课程 2020-03-28 18:09:12
10     msb010           1980.00  ...  课程 2020-03-28 18:09:12

[11 rows x 6 columns]
---------------print(df.duplicated())---------------
----------查找是否有重复值(完全一样的行)----------
0     False
1     False
2     False
3     False
4     False
5     False
6     False
7     False
8     False
9     False
10     True
dtype: bool
---------------df1 = df.drop_duplicates()---------------
----------删除所有完全重复的数据----------
  买家会员名  买家实际支付金额  ...  类别        订单付款时间
0     msb001          30960.00  ...  课程 2020-10-09 22:54:26
1     msb002              1.00  ...   NaN 2020-10-09 22:52:42
2     msb003           9980.00  ...  课程 2020-01-19 12:53:01
3     msb004           9980.00  ...  课程 2020-06-30 11:46:14
4     msb005              9.90  ...   NaN 2020-03-23 18:25:45
5     msb006              0.02  ...  课程 2020-03-24 19:25:45
6     msb007           2400.00  ...  课程 2020-03-25 11:00:45
7     msb008              1.00  ...  课程 2020-03-26 23:11:11
8     msb009           2980.00  ...  课程 2020-03-27 07:25:30
9     msb010           1980.00  ...  课程 2020-03-28 18:09:12

[10 rows x 6 columns]
---------------df2 = df.drop_duplicates(['买家实际支付金额'])---------------
----------删除指定列的重复数据----------
  买家会员名  买家实际支付金额  ...  类别        订单付款时间
0     msb001          30960.00  ...  课程 2020-10-09 22:54:26
1     msb002              1.00  ...   NaN 2020-10-09 22:52:42
2     msb003           9980.00  ...  课程 2020-01-19 12:53:01
4     msb005              9.90  ...   NaN 2020-03-23 18:25:45
5     msb006              0.02  ...  课程 2020-03-24 19:25:45
6     msb007           2400.00  ...  课程 2020-03-25 11:00:45
8     msb009           2980.00  ...  课程 2020-03-27 07:25:30
9     msb010           1980.00  ...  课程 2020-03-28 18:09:12

[8 rows x 6 columns]
----------df3 = df.drop_duplicates(['买家实际支付金额'], keep='last')----------
----------保留重复行的最后一行，默认保留重复行的第一行----------
   买家会员名  买家实际支付金额  ...  类别        订单付款时间
0      msb001          30960.00  ...  课程 2020-10-09 22:54:26
3      msb004           9980.00  ...  课程 2020-06-30 11:46:14
4      msb005              9.90  ...   NaN 2020-03-23 18:25:45
5      msb006              0.02  ...  课程 2020-03-24 19:25:45
6      msb007           2400.00  ...  课程 2020-03-25 11:00:45
7      msb008              1.00  ...  课程 2020-03-26 23:11:11
8      msb009           2980.00  ...  课程 2020-03-27 07:25:30
10     msb010           1980.00  ...  课程 2020-03-28 18:09:12

[8 rows x 6 columns]

Process finished with exit code 0
```

## 5. 设置索引

#### 5.1 Series对象重新设置索引

- **df.reindex(labels=None, index=None, column=None, axis=None, method=None, fill_value=nan)**

```python
import pandas as pd
s = pd.Series([11, 22, 33], index=[1, 2, 3])
print(s)

print('-'*15 + '重新设置索引，多出来的默认为NaN' + '-'*15)
print('-'*10 + 's.reindex(range(1, 6))' + '-'*10)
print(s.reindex(range(1, 6)))

print('-'*15 + '重新设置索引，多出来的用0填充' + '-'*15)
print('-'*7 + 's.reindex(range(1, 6), fill_value=0)' + '-'*7)
print(s.reindex(range(1, 6), fill_value=0))

print('-'*15 + '重新设置索引，向前填充' + '-'*15)
print('-'*10 + "s.reindex(range(1, 6), method='ffill')" + '-'*10)
print(s.reindex(range(1, 6), method='ffill'))

print('-'*15 + '重新设置索引，向后填充' + '-'*15)
print('-'*10 + "s.reindex(range(1, 6), method='bfill')" + '-'*10)
print(s.reindex(range(1, 6), method='bfill'))

#result
1    11
2    22
3    33
dtype: int64
---------------重新设置索引，多出来的默认为NaN---------------
----------s.reindex(range(1, 6))----------
1    11.0
2    22.0
3    33.0
4     NaN
5     NaN
dtype: float64
---------------重新设置索引，多出来的用0填充---------------
-------s.reindex(range(1, 6), fill_value=0)-------
1    11
2    22
3    33
4     0
5     0
dtype: int64
---------------重新设置索引，向前填充---------------
----------s.reindex(range(1, 6), method='ffill')----------
1    11
2    22
3    33
4    33
5    33
dtype: int64
---------------重新设置索引，向后填充---------------
----------s.reindex(range(1, 6), method='bfill')----------
1    11.0
2    22.0
3    33.0
4     NaN
5     NaN
dtype: float64

Process finished with exit code 0
```

#### 5.2 DataFrame对象重新设置索引

```python
import pandas as pd
data = [[90, 100, 90], [100, 39, 89], [49, 79, 87]]
index = ['msb1001', 'msb1002', 'msb1003']
columns = ['数学', '语文', '英语']
pd.set_option('display.unicode.east_asian_width', True)
df = pd.DataFrame(data=data, index=index, columns=columns)
print(df)

print('-'*15 + "重设置行索引" + '-'*15)
print("----df.reindex(['msb1001', 'msb1002', 'msb1003', 'msb1004', 'msb1005'])----")
print(df.reindex(['msb1001', 'msb1002', 'msb1003', 'msb1004', 'msb1005']))

print('-'*15 + "重新设置列索引" + '-'*15)
print("---df.reindex(columns=['数学', '语文', '英语', '政治', '历史'])---")
print(df.reindex(columns=['数学', '语文', '英语', '政治', '历史']))

print('-'*15 + "重新设置行索引和列索引" + '-'*15)
print('-------df.reindex(index=[****], columns=[****])---------')
print(df.reindex(index=['msb1001', 'msb1002', 'msb1003', 'msb1004', 'msb1005'], columns=['数学', '语文', '英语', '政治', '历史']))

print('-'*15 + "重新设置行索引和列索引,用0填充" + '-'*15)
print('-------df.reindex(index=[****], columns=[****], fill_value=0)---------')
print(df.reindex(index=['msb1001', 'msb1002', 'msb1003', 'msb1004', 'msb1005'], columns=['数学', '语文', '英语', '政治', '历史'], fill_value=0))

#result
         数学  语文  英语
msb1001    90   100    90
msb1002   100    39    89
msb1003    49    79    87
---------------重设置行索引---------------
----df.reindex(['msb1001', 'msb1002', 'msb1003', 'msb1004', 'msb1005'])----
          数学   语文  英语
msb1001   90.0  100.0  90.0
msb1002  100.0   39.0  89.0
msb1003   49.0   79.0  87.0
msb1004    NaN    NaN   NaN
msb1005    NaN    NaN   NaN
---------------重新设置列索引---------------
---df.reindex(columns=['数学', '语文', '英语', '政治', '历史'])---
         数学  语文  英语  政治  历史
msb1001    90   100    90   NaN   NaN
msb1002   100    39    89   NaN   NaN
msb1003    49    79    87   NaN   NaN
---------------重新设置行索引和列索引---------------
-------df.reindex(index=[****], columns=[****])---------
          数学   语文  英语  政治  历史
msb1001   90.0  100.0  90.0   NaN   NaN
msb1002  100.0   39.0  89.0   NaN   NaN
msb1003   49.0   79.0  87.0   NaN   NaN
msb1004    NaN    NaN   NaN   NaN   NaN
msb1005    NaN    NaN   NaN   NaN   NaN
---------------重新设置行索引和列索引,用0填充---------------
-------df.reindex(index=[****], columns=[****], fill_value=0)---------
         数学  语文  英语  政治  历史
msb1001    90   100    90     0     0
msb1002   100    39    89     0     0
msb1003    49    79    87     0     0
msb1004     0     0     0     0     0
msb1005     0     0     0     0     0

Process finished with exit code 0
```

#### 5.3 设置索引与连续索引

```python
import pandas as pd
df = pd.read_excel('./datas/msb课程记录.xls')
print(df)

print('-'*15 + "设置某列为索引" + '-'*15)
print('-'*12 + "df.set_index(['买家会员名'])" + '-'*12)
print(df.set_index(['买家会员名']))

print('-'*12 + "数据清洗后，设置连续的索引" + '-'*12)
print(df.dropna())

print('----df=df.dropna().reset_index(drop=True)------')
df=df.dropna().reset_index(drop=True)
print(df)

#result
     买家会员名  买家实际支付金额  课程总数量           课程标题    类别              订单付款时间
0   msb001  30960.00    2.0    Java互联网高级架构师   课程 2020-10-09 22:54:26
1   msb002      1.00    1.0       金三银四面试突击班  NaN 2020-10-09 22:52:42
2   msb003   9980.00    1.0    GoLang从入门到精通   课程 2020-01-19 12:53:01
3   msb004   9980.00    NaN      算法与数据结构进阶班   课程 2020-06-30 11:46:14
4   msb005      9.90    1.0       大前端VIP体验营  NaN 2020-03-23 18:25:45
5   msb006      0.02    1.0  零基础速成班HTML+CSS   课程 2020-03-24 19:25:45
6   msb007   2400.00    1.0            操作系统   课程 2020-03-25 11:00:45
7   msb008      1.00    NaN           自定义注解   课程 2020-03-26 23:11:11
8   msb009   2980.00    1.0         多线程与高并发   课程 2020-03-27 07:25:30
9   msb010   1980.00    1.0            科技英语   课程 2020-03-28 18:09:12
10  msb010   1980.00    1.0            科技英语   课程 2020-03-28 18:09:12
---------------设置某列为索引---------------
------------df.set_index(['买家会员名'])------------
        买家实际支付金额  课程总数量           课程标题    类别              订单付款时间
买家会员名                                                           
msb001  30960.00    2.0    Java互联网高级架构师   课程 2020-10-09 22:54:26
msb002      1.00    1.0       金三银四面试突击班  NaN 2020-10-09 22:52:42
msb003   9980.00    1.0    GoLang从入门到精通   课程 2020-01-19 12:53:01
msb004   9980.00    NaN      算法与数据结构进阶班   课程 2020-06-30 11:46:14
msb005      9.90    1.0       大前端VIP体验营  NaN 2020-03-23 18:25:45
msb006      0.02    1.0  零基础速成班HTML+CSS   课程 2020-03-24 19:25:45
msb007   2400.00    1.0            操作系统   课程 2020-03-25 11:00:45
msb008      1.00    NaN           自定义注解   课程 2020-03-26 23:11:11
msb009   2980.00    1.0         多线程与高并发   课程 2020-03-27 07:25:30
msb010   1980.00    1.0            科技英语   课程 2020-03-28 18:09:12
msb010   1980.00    1.0            科技英语   课程 2020-03-28 18:09:12
------------数据清洗后，设置连续的索引------------
     买家会员名  买家实际支付金额  课程总数量           课程标题   类别              订单付款时间
0   msb001  30960.00    2.0    Java互联网高级架构师  课程 2020-10-09 22:54:26
2   msb003   9980.00    1.0    GoLang从入门到精通  课程 2020-01-19 12:53:01
5   msb006      0.02    1.0  零基础速成班HTML+CSS  课程 2020-03-24 19:25:45
6   msb007   2400.00    1.0            操作系统  课程 2020-03-25 11:00:45
8   msb009   2980.00    1.0         多线程与高并发  课程 2020-03-27 07:25:30
9   msb010   1980.00    1.0            科技英语  课程 2020-03-28 18:09:12
10  msb010   1980.00    1.0            科技英语  课程 2020-03-28 18:09:12
----df=df.dropna().reset_index(drop=True)------
    买家会员名  买家实际支付金额  课程总数量           课程标题   类别              订单付款时间
0  msb001  30960.00    2.0    Java互联网高级架构师  课程 2020-10-09 22:54:26
1  msb003   9980.00    1.0    GoLang从入门到精通  课程 2020-01-19 12:53:01
2  msb006      0.02    1.0  零基础速成班HTML+CSS  课程 2020-03-24 19:25:45
3  msb007   2400.00    1.0            操作系统  课程 2020-03-25 11:00:45
4  msb009   2980.00    1.0         多线程与高并发  课程 2020-03-27 07:25:30
5  msb010   1980.00    1.0            科技英语  课程 2020-03-28 18:09:12
6  msb010   1980.00    1.0            科技英语  课程 2020-03-28 18:09:12

Process finished with exit code 0
```

## 6. 数据排序

### 6.1 数据排序（Series和DataFrame通用）

- **df.sort_values(by, axis=0, ascending=True, inplace=False, kind='quicksort', na_position='last', ignore_index=False)**
  - by：要排序的名称列表
  - axis：轴，0表示行、1表示列，默认行排序
  - ascending：排序方式，默认值为True：升序排序，如果为False，则为降序排序
  - inplace：布尔值，默认值为False，如果为True，则就地排序
  - kind：指定排序算法，'quicksort'(快排)、'mergesort'(归并)、'heapsort'(堆排)，默认值为快排
  - na_position：空值(NaN)的位置，值为first：空值在数据开头，last空值在最后，默认为last
  - ignore_index：布尔值，是否忽略索引，值为True标记索引(从0开始排序的整数值)，值为False则忽略索引

```python
import pandas as pd
df = pd.read_excel('./datas/电脑配件销售记录.xlsx')
pd.set_option('display.unicode.east_asian_width', True)
print(df.head())

print('-'*15 + "按某一列的数据进行排序,默认升序排列" + '-'*15)
print('-'*10 + "df = df.sort_values(by='成交金额')" + '-'*10)
df = df.sort_values(by='成交金额')
print(df.head())

print('-'*15 + "按某一列的数据进行降序排序" + '-'*15)
print('-'*5 + "df = df.sort_values(by='成交金额', ascending=False)" + '-'*5)
df = df.sort_values(by='成交金额', ascending=False)
print(df.head())

print('-'*15 + "按多列进行降序排序" + '-'*15)
print('先按数量排序，数量相同的时候按成交金额排序')
print('-'*5 + "df = df.sort_values(by=['数量', '成交金额'], ascending=False)" + '-'*5)
df = df.sort_values(by=['数量', '成交金额'], ascending=[False, True])
print(df.head())

#result
   产品名称  销售员  数量  标准单价  成交金额
0  无线网卡    王丽    10       178      1780
1  无线网卡  李桂林    30       178      5340
2      鼠标    李欢     6       299      1794
3      鼠标    李欢    15       299      4485
4      鼠标  李桂林    16       299      4784
---------------按某一列的数据进行排序,默认升序排列---------------
----------df = df.sort_values(by='成交金额')----------
      产品名称  销售员  数量  标准单价  成交金额
9       麦克风    王丽     4        99       396
10      麦克风    王丽    10        99       990
0     无线网卡    王丽    10       178      1780
2         鼠标    李欢     6       299      1794
14  蓝牙适配器  李桂林    18       108      1944
---------------按某一列的数据进行降序排序---------------
-----df = df.sort_values(by='成交金额', ascending=False)-----
      产品名称  销售员  数量  标准单价  成交金额
6         鼠标  李桂林    77       299     23023
21        键盘    王丽   120       180     21600
5         鼠标    王双    52       299     15548
28     DVD光驱  华国华    48       240     11520
19  蓝牙适配器    李欢    95       108     10260
---------------按多列进行降序排序---------------
先按数量排序，数量相同的时候按成交金额排序
-----df = df.sort_values(by=['数量', '成交金额'], ascending=False)-----
      产品名称  销售员  数量  标准单价  成交金额
21        键盘    王丽   120       180     21600
19  蓝牙适配器    李欢    95       108     10260
6         鼠标  李桂林    77       299     23023
13      麦克风    李欢    62        99      6138
18  蓝牙适配器  李桂林    61       108      6588

Process finished with exit code 0
```

### 6.2 数据排名（Series和DataFrame通用）

- **df.rank(axis=0, method='average', ascending=True, na_option='keep')**

  - axis：轴，0表示行，1表示列，默认按行排序
  - method：表示在具有相同值的情况下使用的排序方法
    - average：默认值，平均排序
    - min：最小值排名
    - max：最大值排名
    - first：按值在原始数据中的出现顺序分配排名
    - dense：密集排名，类似最小值排名，排名相同的数据只占一个名次

  - na_option：空值的排序
    - keep：保留
    - top：如果升序，将最小排名赋给NaN
    - bottom：如果升序，将最大排名赋给NaN

```python
import pandas as pd
df = pd.read_excel('./datas/电脑配件销售记录.xlsx')
pd.set_option('display.unicode.east_asian_width', True)
df = df.sort_values(by='数量', ascending=False)

print('-'*15 + "按数量进行排名,默认按照平均值排名" + '-'*15)
print('-'*8 + "df['数量排名'] = df['数量'].rank(ascending=False)" + '-'*8)
df['数量排名'] = df['数量'].rank(ascending=False)
print(df)

print('-'*15 + "按数量进行排名,按照最小值排名" + '-'*15)
print('-'*8 + "df['数量排名'] = df['数量'].rank(method='min', ascending=False)" + '-'*8)
df['数量排名'] = df['数量'].rank(method='min', ascending=False)
print(df)

#result
---------------按数量进行排名,默认按照平均值排名---------------
--------df['数量排名'] = df['数量'].rank(ascending=False)--------
      产品名称  销售员  数量  标准单价  成交金额  数量排名
21        键盘    王丽   120       180     21600       1.0
19  蓝牙适配器    李欢    95       108     10260       2.0
6         鼠标  李桂林    77       299     23023       3.0
13      麦克风    李欢    62        99      6138       4.0
18  蓝牙适配器  李桂林    61       108      6588       5.0
17  蓝牙适配器  李桂林    58       108      6264       6.0
12      麦克风  李桂林    55        99      5445       7.0
5         鼠标    王双    52       299     15548       8.0
16  蓝牙适配器    王丽    51       108      5508       9.0
28     DVD光驱  华国华    48       240     11520      10.0
11      麦克风  华国华    47        99      4653      11.0
8       手写板    王丽    43       190      8170      12.0
27     DVD光驱  华国华    40       240      9600      13.0
15  蓝牙适配器  李桂林    39       108      4212      14.0
26     DVD光驱    王丽    32       240      7680      15.0
25     DVD光驱    王丽    30       240      7200      16.5
1     无线网卡  李桂林    30       178      5340      16.5
24    SD存储卡  李桂林    20       290      5800      18.5
20        键盘  华国华    20       180      3600      18.5
14  蓝牙适配器  李桂林    18       108      1944      20.0
4         鼠标  李桂林    16       299      4784      21.0
23    SD存储卡  李桂林    15       290      4350      22.5
3         鼠标    李欢    15       299      4485      22.5
7       手写板  华国华    14       190      2660      24.0
10      麦克风    王丽    10        99       990      25.5
0     无线网卡    王丽    10       178      1780      25.5
22    SD存储卡    李欢     9       290      2610      27.0
2         鼠标    李欢     6       299      1794      28.0
9       麦克风    王丽     4        99       396      29.0
---------------按数量进行排名,按照最小值排名---------------
--------df['数量排名'] = df['数量'].rank(method='min', ascending=False)--------
      产品名称  销售员  数量  标准单价  成交金额  数量排名
21        键盘    王丽   120       180     21600       1.0
19  蓝牙适配器    李欢    95       108     10260       2.0
6         鼠标  李桂林    77       299     23023       3.0
13      麦克风    李欢    62        99      6138       4.0
18  蓝牙适配器  李桂林    61       108      6588       5.0
17  蓝牙适配器  李桂林    58       108      6264       6.0
12      麦克风  李桂林    55        99      5445       7.0
5         鼠标    王双    52       299     15548       8.0
16  蓝牙适配器    王丽    51       108      5508       9.0
28     DVD光驱  华国华    48       240     11520      10.0
11      麦克风  华国华    47        99      4653      11.0
8       手写板    王丽    43       190      8170      12.0
27     DVD光驱  华国华    40       240      9600      13.0
15  蓝牙适配器  李桂林    39       108      4212      14.0
26     DVD光驱    王丽    32       240      7680      15.0
25     DVD光驱    王丽    30       240      7200      16.0
1     无线网卡  李桂林    30       178      5340      16.0
24    SD存储卡  李桂林    20       290      5800      18.0
20        键盘  华国华    20       180      3600      18.0
14  蓝牙适配器  李桂林    18       108      1944      20.0
4         鼠标  李桂林    16       299      4784      21.0
23    SD存储卡  李桂林    15       290      4350      22.0
3         鼠标    李欢    15       299      4485      22.0
7       手写板  华国华    14       190      2660      24.0
10      麦克风    王丽    10        99       990      25.0
0     无线网卡    王丽    10       178      1780      25.0
22    SD存储卡    李欢     9       290      2610      27.0
2         鼠标    李欢     6       299      1794      28.0
9       麦克风    王丽     4        99       396      29.0

Process finished with exit code 0
```

## 7. 数据计算

- 求和：**sum([axis, skipna])**
  - axis=1表示按行加，axis=0表示按列加，默认列加
  - skipna=1表示将NaN转0，skipna=0表示不转

- 求均值：**mean([axis], skipna)**
  - axis=1表示按行加，axis=0表示按列加，默认列加
  - skipna=1表示将NaN转0，skipna=0表示不转

- 最大值：**max([axis, skipna])**
  - axis=1表示按行加，axis=0表示按列加，默认列加
  - skipna=1表示将NaN转0，skipna=0表示不转

- 最小值：**min([axis, skipna])**
  - axis=1表示按行加，axis=0表示按列加，默认列加
  - skipna=1表示将NaN转0，skipna=0表示不转

- 中位数：**median(axis=None, skipna=None)**
  - axis=1表示行，axis=0表示列，默认为None
  - skipna布尔值，表示计算结果是否排除了NaN/Null，默认值True

- 求众数：**mode(axis=0, dropna=True)**
  - axis=1表示行，axis=0表示列，默认为None
  - dropna布尔值，表示是否删除缺失值，默认为True

- 求无偏样方差：**var(axis=None, skipna=None)**
  - axis=1表示行，axis=0表示列，默认为None
  - skipna布尔值，表示计算结果是否排除了NaN/Null，默认值True

- 标准差：**std(axis=None, skipna=None)**
  - axis=1表示行，axis=0表示列，默认为None
  - skipna布尔值，表示计算结果是否排除了NaN/Null，默认值True

- 分位数：**quantile(q=0.5, axis=0, numeric_only=True)**
  - numeric_only的值为False，将计算日期、时间和时间增量数据的分位数

#### 7.1 求和、均值、最小值、最大值、中位数、众数、标准差

```python
import pandas as pd
pd.set_option('display.unicode.east_asian_width', True)
data = [[100, 90, 100], [100, 76, 76], [76, 90, 76]]
columns = ['数学', '语文', '英语']
df = pd.DataFrame(data=data, columns=columns, index=[1, 2, 3])
print(df)

print('-'*15 + "按行求和" + '-'*15)
print('-'*10 + "df['总成绩'] = df.sum(axis=0)" + '-'*10)
df['总成绩'] = df.sum(axis=1)
print(df)

print('-'*15 + "按列求均值" + '-'*15)
print('-'*8 + "df.append(df.mean(), ignore_index=True)" + '-'*8)
print(df.append(df.mean(), ignore_index=True))

print('-'*15 + "计算最小值" + '-'*15)
print('-------最大值max，中位数median同理--------------')
print('-------df.append(df.min(), ignore_index=True)--------')
print(df.append(df.min(), ignore_index=True))

print('-'*15 + "计算列的众数" + '-'*15)
print('-'*15 + "df.mode()" + '-'*15)
print(df.mode())

print('-'*15 + "计算行的众数" + '-'*15)
print('-'*15 + "df.mode(axis=1)" + '-'*15)
print(df.mode(axis=1))

print('-'*15 + "计算数学列的众数" + '-'*15)
print('-'*15 + "print(df['数学'].mode())" + '-'*15)
print(df['数学'].mode())

print('-'*15 + "求标准差" + '-'*15)
print('-'*15 + "print(df.std())" + '-'*15)
print(df.std())

#result
   数学  语文  英语
1   100    90   100
2   100    76    76
3    76    90    76
---------------按行求和---------------
----------df['总成绩'] = df.sum(axis=0)----------
   数学  语文  英语  总成绩
1   100    90   100     290
2   100    76    76     252
3    76    90    76     242
---------------按列求均值---------------
--------df.append(df.mean(), ignore_index=True)--------
    数学       语文   英语      总成绩
0  100.0  90.000000  100.0  290.000000
1  100.0  76.000000   76.0  252.000000
2   76.0  90.000000   76.0  242.000000
3   92.0  85.333333   84.0  261.333333
---------------计算最小值---------------
-------最大值max，中位数median同理--------------
-------df.append(df.min(), ignore_index=True)--------
   数学  语文  英语  总成绩
0   100    90   100     290
1   100    76    76     252
2    76    90    76     242
3    76    76    76     242
---------------计算列的众数---------------
---------------df.mode()---------------
    数学  语文  英语  总成绩
0  100.0  90.0  76.0     242
1    NaN   NaN   NaN     252
2    NaN   NaN   NaN     290
---------------计算行的众数---------------
---------------df.mode(axis=1)---------------
     0
1  100
2   76
3   76
---------------计算数学列的众数---------------
---------------print(df['数学'].mode())---------------
0    100
Name: 数学, dtype: int64
---------------求标准差---------------
---------------print(df.std())---------------
数学    13.856406
语文     8.082904
英语    13.856406
dtype: float64

Process finished with exit code 0
```

#### 7.2 无偏样方差

```python
import pandas as pd
data = [[135, 140, 138, 145, 140], [140, 145, 139, 142, 132]]
index = ['李凡', '郭曙光']
columns = ['一模', '二模', '三模', '四模', '五模']
df = pd.DataFrame(data=data, index=index, columns=columns)
pd.set_option('display.unicode.east_asian_width', True)
print(df)

print('-'*15 + "求无偏样方差" + '-'*15)
print('-'*10 + "print(df.var(axis=1))" + '-'*10)
print(df.var(axis=1))

#result
        一模  二模  三模  四模  五模
李凡     135   140   138   145   140
郭曙光   140   145   139   142   132
---------------求无偏样方差---------------
----------print(df.var(axis=1))----------
李凡      13.3
郭曙光    23.3
dtype: float64

Process finished with exit code 0
```

#### 7.3 分位数

```python
import pandas as pd
pd.set_option('display.unicode.east_asian_width', True)
data = [120, 110, 112, 100, 98, 34, 123, 115]
columns = ['数学']
df = pd.DataFrame(data=data, columns=columns)
print(df)

print('-'*15 + "计算分位数" + '-'*15)
print('-'*15 + "数学的35%的位置" + '-'*15)
print('-'*15 + "x = df['数学'].quantile(0.35)" + '-'*15)
x = df['数学'].quantile(0.35)
print('-'*15 + "35%以下的人有" + '-'*15)
print('-'*15 + "df[df['数学'] < x]" + '-'*15)
print(df[df['数学'] < x])

print('-'*15 + "35%以上的人有" + '-'*15)
print('-'*15 + "df[df['数学'] >= x]" + '-'*15)
print(df[df['数学'] >= x])

#result
   数学
0   120
1   110
2   112
3   100
4    98
5    34
6   123
7   115
---------------计算分位数---------------
---------------数学的35%的位置---------------
---------------x = df['数学'].quantile(0.35)---------------
---------------35%以下的人有---------------
---------------df[df['数学'] < x]---------------
   数学
3   100
4    98
5    34
---------------35%以上的人有---------------
---------------df[df['数学'] >= x]---------------
   数学
0   120
1   110
2   112
6   123
7   115

Process finished with exit code 0
```

```python
import pandas as pd
df = pd.DataFrame(
{
    'A': [1, 2],
    'B': [pd.Timestamp(2020), pd.Timestamp(2021)],
    'C': [pd.Timedelta('1 days'), pd.Timedelta('2 days')]
})
print(df.quantile(0.5, numeric_only=False))

#result
A                              1.5
B    1970-01-01 00:00:00.000002020
C                  1 days 12:00:00
Name: 0.5, dtype: object

Process finished with exit code 0
```

## 8. 数据格式化

### 8.1 设置小数位数

```python
import pandas as pd
df = pd.read_excel('./datas/格式化数据.xlsx')
print(df)

print('-'*15 + "所有元素保留两位小数,四舍五入" + '-'*15)
print('-'*15 + "df.round(2)" + '-'*15)
print(df.round(2))

print('-'*15 + "指定列保留两位小数,四舍五入" + '-'*15)
print('-'*15 + "df.round({'A1': 1, 'A2': 2})" + '-'*15)
print(df.round({'A1': 1, 'A2': 2}))

#result
         A1        A2        A3        A4        A5
0  0.527350  0.410396  0.131101  0.565818  0.322695
1  0.007817  0.663029  0.480029  0.551382  0.603932
2  0.123241  0.935813  0.052935  0.207342  0.183324
3  0.405295  0.623856  0.254653  0.368602  0.751753
4  0.195120  0.623856  0.477747  0.592885  0.751753
---------------所有元素保留两位小数,四舍五入---------------
---------------df.round(2)---------------
     A1    A2    A3    A4    A5
0  0.53  0.41  0.13  0.57  0.32
1  0.01  0.66  0.48  0.55  0.60
2  0.12  0.94  0.05  0.21  0.18
3  0.41  0.62  0.25  0.37  0.75
4  0.20  0.62  0.48  0.59  0.75
---------------指定列保留两位小数,四舍五入---------------
---------------df.round({'A1': 1, 'A2': 2})---------------
    A1    A2        A3        A4        A5
0  0.5  0.41  0.131101  0.565818  0.322695
1  0.0  0.66  0.480029  0.551382  0.603932
2  0.1  0.94  0.052935  0.207342  0.183324
3  0.4  0.62  0.254653  0.368602  0.751753
4  0.2  0.62  0.477747  0.592885  0.751753

Process finished with exit code 0
```

### 8.2 设置百分比

```python
import pandas as pd
df = pd.read_excel('./datas/格式化数据.xlsx')
print(df)

print('-'*15 + "apply函数对A1列设置百分比" + '-'*15)
print('-'*5 + "df['百分比'] = df['A1'].apply(lambda x:format(x, '.1%'))" + '-'*5)
df['百分比'] = df['A1'].apply(lambda x: format(x, '.1%'))
print(df)

print('-'*15 + "map函数对A1列设置百分比" + '-'*15)
print('-'*5 + "df['百分比'] = df['A1'].map(lambda x:format(x, '.2%'))" + '-'*5)
df['百分比'] = df['A1'].map(lambda x: format(x, '.2%'))
print(df)

#result
         A1        A2        A3        A4        A5
0  0.527350  0.410396  0.131101  0.565818  0.322695
1  0.007817  0.663029  0.480029  0.551382  0.603932
2  0.123241  0.935813  0.052935  0.207342  0.183324
3  0.405295  0.623856  0.254653  0.368602  0.751753
4  0.195120  0.623856  0.477747  0.592885  0.751753
---------------apply函数对A1列设置百分比---------------
-----df['百分比'] = df['A1'].apply(lambda x:format(x, '.1%'))-----
         A1        A2        A3        A4        A5    百分比
0  0.527350  0.410396  0.131101  0.565818  0.322695  52.7%
1  0.007817  0.663029  0.480029  0.551382  0.603932   0.8%
2  0.123241  0.935813  0.052935  0.207342  0.183324  12.3%
3  0.405295  0.623856  0.254653  0.368602  0.751753  40.5%
4  0.195120  0.623856  0.477747  0.592885  0.751753  19.5%
---------------map函数对A1列设置百分比---------------
-----df['百分比'] = df['A1'].map(lambda x:format(x, '.2%'))-----
         A1        A2        A3        A4        A5     百分比
0  0.527350  0.410396  0.131101  0.565818  0.322695  52.73%
1  0.007817  0.663029  0.480029  0.551382  0.603932   0.78%
2  0.123241  0.935813  0.052935  0.207342  0.183324  12.32%
3  0.405295  0.623856  0.254653  0.368602  0.751753  40.53%
4  0.195120  0.623856  0.477747  0.592885  0.751753  19.51%

Process finished with exit code 0
```

### 8.3 设置千位分隔符

```python
import pandas as pd
df = pd.read_excel('./datas/msb课程记录.xls')
pd.set_option('display.unicode.east_asian_width', True)
print(df)

print('-'*20 + "设置千位分隔符" + '-'*20)
print("---df['买家实际支付金额'].apply(lambda x: format(int(x), ','))----")
df['买家实际支付金额'] = df['买家实际支付金额'].apply(lambda x: format(int(x), ','))
print(df)

#result
   买家会员名  买家实际支付金额  ...  类别        订单付款时间
0      msb001          30960.00  ...  课程 2020-10-09 22:54:26
1      msb002              1.00  ...   NaN 2020-10-09 22:52:42
2      msb003           9980.00  ...  课程 2020-01-19 12:53:01
3      msb004           9980.00  ...  课程 2020-06-30 11:46:14
4      msb005              9.90  ...   NaN 2020-03-23 18:25:45
5      msb006              0.02  ...  课程 2020-03-24 19:25:45
6      msb007           2400.00  ...  课程 2020-03-25 11:00:45
7      msb008              1.00  ...  课程 2020-03-26 23:11:11
8      msb009           2980.00  ...  课程 2020-03-27 07:25:30
9      msb010           1980.00  ...  课程 2020-03-28 18:09:12
10     msb010           1980.00  ...  课程 2020-03-28 18:09:12

[11 rows x 6 columns]
--------------------设置千位分隔符--------------------
---df['买家实际支付金额'].apply(lambda x: format(int(x), ','))----
   买家会员名 买家实际支付金额  ...  类别        订单付款时间
0      msb001           30,960  ...  课程 2020-10-09 22:54:26
1      msb002                1  ...   NaN 2020-10-09 22:52:42
2      msb003            9,980  ...  课程 2020-01-19 12:53:01
3      msb004            9,980  ...  课程 2020-06-30 11:46:14
4      msb005                9  ...   NaN 2020-03-23 18:25:45
5      msb006                0  ...  课程 2020-03-24 19:25:45
6      msb007            2,400  ...  课程 2020-03-25 11:00:45
7      msb008                1  ...  课程 2020-03-26 23:11:11
8      msb009            2,980  ...  课程 2020-03-27 07:25:30
9      msb010            1,980  ...  课程 2020-03-28 18:09:12
10     msb010            1,980  ...  课程 2020-03-28 18:09:12

[11 rows x 6 columns]

Process finished with exit code 0
```

### 8.4 apply()、map()、applymap()函数的区别

- apply()可以在Series和DataFrame对象中起作用，对Series的每一个元素都执行一次函数，对DataFrame中的某一行或某一列的所有元素都执行一次函数

  ```python
  import pandas as pd
  print('-'*15 + "Series对象" + '-'*15)
  s = pd.Series(data=[10, 20, 30, 40], index=['a', 'b', 'c', 'd'])
  print(s)
  print('-'*15 + "s.apply(lambda x: x+10)" + '-'*15)
  s = s.apply(lambda x: x+10)
  print(s)
  
  print('-'*15 + "DataFrame对象" + '-'*15)
  df = pd.DataFrame(data=[[10, 20, 30, 40], [11, 22 ,33, 44]], index=['a', 'b'], columns=['A', 'B', 'C', 'D'])
  print(df)
  print("------df2 = df.apply(lambda x: x.sum(), axis=0)---------")
  df2 = df.apply(lambda x: x.sum(), axis=0)
  print(df2)
  print("------df3 = df.apply(lambda x: x.sum(), axis=1)---------")
  df3 = df.apply(lambda x: x.sum(), axis=1)
  print(df3)
  
  #result
  ---------------Series对象---------------
  a    10
  b    20
  c    30
  d    40
  dtype: int64
  ---------------s.apply(lambda x: x+10)---------------
  a    20
  b    30
  c    40
  d    50
  dtype: int64
  ---------------DataFrame对象---------------
      A   B   C   D
  a  10  20  30  40
  b  11  22  33  44
  ------df2 = df.apply(lambda x: x.sum(), axis=0)---------
  A    21
  B    42
  C    63
  D    84
  dtype: int64
  ------df3 = df.apply(lambda x: x.sum(), axis=1)---------
  a    100
  b    110
  dtype: int64
  
  Process finished with exit code 0
  ```

  

- map只能应用在Series对象的每个元素上

- map的参数是一个函数或者字典

  ```python
  import pandas as pd
  df = pd.DataFrame(data=[['男'], ['女'], ['男'], ['男']], index=['张三', '李四', '王五', '陈六'], columns=['性别'])
  print(df)
  print('type(df["性别"]) =', type(df["性别"]))
  def gender(g):
      if g=='男':
          return 0
      else:
          return 1
  print("----df2 = df['性别'].map(gender)-------")
  df2 = df['性别'].map(gender)
  print(df2)
  
  print("----df3 = df['性别'].map({'男': 1, '女': 0})-------")
  df3 = df['性别'].map({'男': 1, '女': 0})
  print(df3)
  
  #result
     性别
  张三  男
  李四  女
  王五  男
  陈六  男
  type(df["性别"]) = <class 'pandas.core.series.Series'>
  ----df2 = df['性别'].map(gender)-------
  张三    0
  李四    1
  王五    0
  陈六    0
  Name: 性别, dtype: int64
  ----df3 = df['性别'].map({'男': 1, '女': 0})-------
  张三    1
  李四    0
  王五    1
  陈六    1
  Name: 性别, dtype: int64
  
  Process finished with exit code 0
  ```

  

- applymap将函数应用到DataFrame的每一个元素中，与apply的区别是，apply只能应用到某列或某行

  ```python
  import pandas as pd
  df = pd.DataFrame(data=[[10, 20, 30, 40], [11, 22 ,33, 44]], index=['a', 'b'], columns=['A', 'B', 'C', 'D'])
  print(df)
  print("--------df = df.applymap(lambda x: x+10)-------------")
  df = df.applymap(lambda x: x+10)
  print(df)
  
  #result
      A   B   C   D
  a  10  20  30  40
  b  11  22  33  44
  --------df = df.applymap(lambda x: x+10)-------------
      A   B   C   D
  a  20  30  40  50
  b  21  32  43  54
  
  Process finished with exit code 0
  ```

  

## 9. 数据分组

### 9.1 数据分组的计算

- **df.groupby(by=None, axis=0, as_index=True, sort=True)**
  - by：分组标准
  - axis：0表示按列分组，1表示按行分组，默认为列分组
  - as_index：布尔值，返回以组标签为索引的对象，若改为False，则用0123作为索引
  - sort：排序，默认是True

```python
import pandas as pd
pd.set_option('display.unicode.east_asian_width', True)
df = pd.read_excel('./datas/电脑配件销售记录.xlsx')
df1 = df[['产品名称', '数量', '标准单价']]
print(df1)
print('-'*15 + "按照一列进行分组" + '-'*15)
print('-'*15 + "df1.groupby('产品名称').sum()" + '-'*15)
print(df1.groupby('产品名称').sum())
print('-'*40)
print('-'*40)

df2 = df[['产品名称', '销售员', '数量']]
print(df2)
print('-'*15 + "按照多列进行分组" + '-'*15)
print('-'*6 + "df1.groupby(['产品名称', '销售员']).sum()" + '-'*6)
print(df2.groupby(['产品名称', '销售员']).sum())
print('-'*40)
print('-'*40)

df3 = df[['产品名称', '数量', '标准单价']]
print('-'*15 + "分组后按照指定列求和" + '-'*15)
print('-'*15 + "df3.groupby('产品名称')['数量'].sum()" + '-'*15)
print(df3.groupby('产品名称')['数量'].sum())

#result
      产品名称  数量  标准单价
0     无线网卡    10       178
1     无线网卡    30       178
2         鼠标     6       299
3         鼠标    15       299
4         鼠标    16       299
5         鼠标    52       299
6         鼠标    77       299
7       手写板    14       190
8       手写板    43       190
9       麦克风     4        99
10      麦克风    10        99
11      麦克风    47        99
12      麦克风    55        99
13      麦克风    62        99
14  蓝牙适配器    18       108
15  蓝牙适配器    39       108
16  蓝牙适配器    51       108
17  蓝牙适配器    58       108
18  蓝牙适配器    61       108
19  蓝牙适配器    95       108
20        键盘    20       180
21        键盘   120       180
22    SD存储卡     9       290
23    SD存储卡    15       290
24    SD存储卡    20       290
25     DVD光驱    30       240
26     DVD光驱    32       240
27     DVD光驱    40       240
28     DVD光驱    48       240
---------------按照一列进行分组---------------
---------------df1.groupby('产品名称').sum()---------------
            数量  标准单价
产品名称                  
DVD光驱      150       960
SD存储卡      44       870
手写板        57       380
无线网卡      40       356
蓝牙适配器   322       648
键盘         140       360
麦克风       178       495
鼠标         166      1495
----------------------------------------
----------------------------------------
      产品名称  销售员  数量
0     无线网卡    王丽    10
1     无线网卡  李桂林    30
2         鼠标    李欢     6
3         鼠标    李欢    15
4         鼠标  李桂林    16
5         鼠标    王双    52
6         鼠标  李桂林    77
7       手写板  华国华    14
8       手写板    王丽    43
9       麦克风    王丽     4
10      麦克风    王丽    10
11      麦克风  华国华    47
12      麦克风  李桂林    55
13      麦克风    李欢    62
14  蓝牙适配器  李桂林    18
15  蓝牙适配器  李桂林    39
16  蓝牙适配器    王丽    51
17  蓝牙适配器  李桂林    58
18  蓝牙适配器  李桂林    61
19  蓝牙适配器    李欢    95
20        键盘  华国华    20
21        键盘    王丽   120
22    SD存储卡    李欢     9
23    SD存储卡  李桂林    15
24    SD存储卡  李桂林    20
25     DVD光驱    王丽    30
26     DVD光驱    王丽    32
27     DVD光驱  华国华    40
28     DVD光驱  华国华    48
---------------按照多列进行分组---------------
------df1.groupby(['产品名称', '销售员']).sum()------
                   数量
产品名称   销售员      
DVD光驱    华国华    88
           王丽      62
SD存储卡   李桂林    35
           李欢       9
手写板     华国华    14
           王丽      43
无线网卡   李桂林    30
           王丽      10
蓝牙适配器 李桂林   176
           李欢      95
           王丽      51
键盘       华国华    20
           王丽     120
麦克风     华国华    47
           李桂林    55
           李欢      62
           王丽      14
鼠标       李桂林    93
           李欢      21
           王双      52
----------------------------------------
----------------------------------------
---------------分组后按照指定列求和---------------
---------------df3.groupby('产品名称')['数量'].sum()---------------
产品名称
DVD光驱       150
SD存储卡       44
手写板         57
无线网卡       40
蓝牙适配器    322
键盘          140
麦克风        178
鼠标          166
Name: 数量, dtype: int64

Process finished with exit code 0
```



### 9.2 数据分组的迭代

- 单列分组迭代

  ```python
  import pandas as pd
  pd.set_option('display.unicode.east_asian_width', True)
  df = pd.read_excel('./datas/电脑配件销售记录.xlsx')
  df1 = df[['产品名称', '数量', '标准单价']]
  for name, group in df1.groupby('产品名称'):
      print(name)
      print(group)
      print('-'*40)
  
  #result
  DVD光驱
     产品名称  数量  标准单价
  25  DVD光驱    30       240
  26  DVD光驱    32       240
  27  DVD光驱    40       240
  28  DVD光驱    48       240
  ----------------------------------------
  SD存储卡
      产品名称  数量  标准单价
  22  SD存储卡     9       290
  23  SD存储卡    15       290
  24  SD存储卡    20       290
  ----------------------------------------
  手写板
    产品名称  数量  标准单价
  7   手写板    14       190
  8   手写板    43       190
  ----------------------------------------
  无线网卡
     产品名称  数量  标准单价
  0  无线网卡    10       178
  1  无线网卡    30       178
  ----------------------------------------
  蓝牙适配器
        产品名称  数量  标准单价
  14  蓝牙适配器    18       108
  15  蓝牙适配器    39       108
  16  蓝牙适配器    51       108
  17  蓝牙适配器    58       108
  18  蓝牙适配器    61       108
  19  蓝牙适配器    95       108
  ----------------------------------------
  键盘
     产品名称  数量  标准单价
  20     键盘    20       180
  21     键盘   120       180
  ----------------------------------------
  麦克风
     产品名称  数量  标准单价
  9    麦克风     4        99
  10   麦克风    10        99
  11   麦克风    47        99
  12   麦克风    55        99
  13   麦克风    62        99
  ----------------------------------------
  鼠标
    产品名称  数量  标准单价
  2     鼠标     6       299
  3     鼠标    15       299
  4     鼠标    16       299
  5     鼠标    52       299
  6     鼠标    77       299
  ----------------------------------------
  
  Process finished with exit code 0
  ```

- 多列分组迭代

  ```python
  import pandas as pd
  pd.set_option('display.unicode.east_asian_width', True)
  df = pd.read_excel('./datas/电脑配件销售记录.xlsx')
  df1 = df[['产品名称', '销售员', '数量']]
  df1 = df1.groupby(['产品名称', '销售员'])
  for (k1, k2), group in df1:
      print(k1, k2)
      print(group)
      print('-'*40)
      
  #result
  DVD光驱 华国华
     产品名称  销售员  数量
  27  DVD光驱  华国华    40
  28  DVD光驱  华国华    48
  ----------------------------------------
  DVD光驱 王丽
     产品名称 销售员  数量
  25  DVD光驱   王丽    30
  26  DVD光驱   王丽    32
  ----------------------------------------
  SD存储卡 李桂林
      产品名称  销售员  数量
  23  SD存储卡  李桂林    15
  24  SD存储卡  李桂林    20
  ----------------------------------------
  SD存储卡 李欢
      产品名称 销售员  数量
  22  SD存储卡   李欢     9
  ----------------------------------------
  手写板 华国华
    产品名称  销售员  数量
  7   手写板  华国华    14
  ----------------------------------------
  手写板 王丽
    产品名称 销售员  数量
  8   手写板   王丽    43
  ----------------------------------------
  无线网卡 李桂林
     产品名称  销售员  数量
  1  无线网卡  李桂林    30
  ----------------------------------------
  无线网卡 王丽
     产品名称 销售员  数量
  0  无线网卡   王丽    10
  ----------------------------------------
  蓝牙适配器 李桂林
        产品名称  销售员  数量
  14  蓝牙适配器  李桂林    18
  15  蓝牙适配器  李桂林    39
  17  蓝牙适配器  李桂林    58
  18  蓝牙适配器  李桂林    61
  ----------------------------------------
  蓝牙适配器 李欢
        产品名称 销售员  数量
  19  蓝牙适配器   李欢    95
  ----------------------------------------
  蓝牙适配器 王丽
        产品名称 销售员  数量
  16  蓝牙适配器   王丽    51
  ----------------------------------------
  键盘 华国华
     产品名称  销售员  数量
  20     键盘  华国华    20
  ----------------------------------------
  键盘 王丽
     产品名称 销售员  数量
  21     键盘   王丽   120
  ----------------------------------------
  麦克风 华国华
     产品名称  销售员  数量
  11   麦克风  华国华    47
  ----------------------------------------
  麦克风 李桂林
     产品名称  销售员  数量
  12   麦克风  李桂林    55
  ----------------------------------------
  麦克风 李欢
     产品名称 销售员  数量
  13   麦克风   李欢    62
  ----------------------------------------
  麦克风 王丽
     产品名称 销售员  数量
  9    麦克风   王丽     4
  10   麦克风   王丽    10
  ----------------------------------------
  鼠标 李桂林
    产品名称  销售员  数量
  4     鼠标  李桂林    16
  6     鼠标  李桂林    77
  ----------------------------------------
  鼠标 李欢
    产品名称 销售员  数量
  2     鼠标   李欢     6
  3     鼠标   李欢    15
  ----------------------------------------
  鼠标 王双
    产品名称 销售员  数量
  5     鼠标   王双    52
  ----------------------------------------
  
  Process finished with exit code 0
  ```



### 9.3 聚合函数

- 对不同的列，采用相同的聚合函数

  ```python
  import pandas as pd
  pd.set_option('display.unicode.east_asian_width', True)
  df = pd.read_excel('./datas/电脑配件销售记录.xlsx')
  df1 = df[['产品名称', '数量']]
  print(df1.groupby('产品名称').agg(['sum', 'mean']))
  
  #result
             数量           
              sum       mean
  产品名称                  
  DVD光驱     150  37.500000
  SD存储卡     44  14.666667
  手写板       57  28.500000
  无线网卡     40  20.000000
  蓝牙适配器  322  53.666667
  键盘        140  70.000000
  麦克风      178  35.600000
  鼠标        166  33.200000
  
  Process finished with exit code 0
  ```

- 对不同的列，采用不同的聚合函数

  ```python
  import pandas as pd
  pd.set_option('display.unicode.east_asian_width', True)
  df = pd.read_excel('./datas/电脑配件销售记录.xlsx')
  df1 = df[['产品名称', '数量', '成交金额']]
  print(df1.groupby('产品名称').agg({'数量': ['sum', 'mean'], '成交金额': ['max', 'min']}))
  
  #result
             数量            成交金额      
              sum       mean      max   min
  产品名称                                 
  DVD光驱     150  37.500000    11520  7200
  SD存储卡     44  14.666667     5800  2610
  手写板       57  28.500000     8170  2660
  无线网卡     40  20.000000     5340  1780
  蓝牙适配器  322  53.666667    10260  1944
  键盘        140  70.000000    21600  3600
  麦克风      178  35.600000     6138   396
  鼠标        166  33.200000    23023  1794
  
  Process finished with exit code 0
  ```

  

### 9.4 自定义函数实现分组统计



### 9.5 根据字典或Series对象进行分组统计

- 字典

  ```python
  import pandas as pd
  pd.set_option('display.unicode.east_asian_width', True)
  pd.set_option('display.max_columns', 500)
  pd.set_option('display.width', 1000)
  df = pd.read_excel('./datas/JD手机销售数据.xlsx')
  df = df.set_index('商品名称')
  print(df)
  dic1 = {
      '北京出库销量': '华北地区',
      '上海出库销量': '华东地区',
      '广州出库销量': '华南地区',
      '天津出库销量': '华北地区',
      '苏州出库销量': '华东地区',
      '沈阳出库销量': '东北地区',
      '杭州出库销量': '华东地区'
  }
  df1 = df.groupby(dic1, axis=1).sum()
  print(df1)
  
  #result
                   北京出库销量  上海出库销量  广州出库销量  天津出库销量  苏州出库销量  沈阳出库销量  杭州出库销量
  商品名称                                                                                                         
  荣耀V40轻奢版             747           666           578           284           246           156           152
  OPPO A93                  318           250           230           113            92            66            63
  Apple iPhone 11           255           196           189           115            88            48            57
  OPPO K7x                  175           146           136            85            65            32            47
  OPPO Reno5                149           100           115            82            63            37            40
  Apple iPhone 12           119            98            88            29            25            34            40
  荣耀X10                    88            69            81            48            43            29            29
  Redmi 9                    84            64            75            53            35            13            23
  Redmi K30S                 56            39            51            27            16             9             7
  OPPOA8                     48            45            42            18            22             5            12
                   东北地区  华东地区  华北地区  华南地区
  商品名称                                               
  荣耀V40轻奢版           156      1064      1031       578
  OPPO A93               66       405       431       230
  Apple iPhone 11        48       341       370       189
  OPPO K7x               32       258       260       136
  OPPO Reno5             37       203       231       115
  Apple iPhone 12        34       163       148        88
  荣耀X10                 29       141       136        81
  Redmi 9                13       122       137        75
  Redmi K30S              9        62        83        51
  OPPOA8                  5        79        66        42
  
  Process finished with exit code 0
  ```

- Series对象

  ```python
  import pandas as pd
  pd.set_option('display.unicode.east_asian_width', True)
  pd.set_option('display.max_columns', 500)
  pd.set_option('display.width', 1000)
  df = pd.read_excel('./datas/JD手机销售数据.xlsx')
  df = df.set_index('商品名称')
  print(df)
  dic1 = {
      '北京出库销量': '华北地区',
      '上海出库销量': '华东地区',
      '广州出库销量': '华南地区',
      '天津出库销量': '华北地区',
      '苏州出库销量': '华东地区',
      '沈阳出库销量': '东北地区',
      '杭州出库销量': '华东地区'
  }
  s = pd.Series(dic1)
  print(s)
  print('-'*50)
  df1 = df.groupby(s, axis=1).sum()
  print(df1)
  
  #result
                   北京出库销量  上海出库销量  广州出库销量  天津出库销量  苏州出库销量  沈阳出库销量  杭州出库销量
  商品名称                                                                                                         
  荣耀V40轻奢版             747           666           578           284           246           156           152
  OPPO A93                  318           250           230           113            92            66            63
  Apple iPhone 11           255           196           189           115            88            48            57
  OPPO K7x                  175           146           136            85            65            32            47
  OPPO Reno5                149           100           115            82            63            37            40
  Apple iPhone 12           119            98            88            29            25            34            40
  荣耀X10                    88            69            81            48            43            29            29
  Redmi 9                    84            64            75            53            35            13            23
  Redmi K30S                 56            39            51            27            16             9             7
  OPPOA8                     48            45            42            18            22             5            12
  北京出库销量    华北地区
  上海出库销量    华东地区
  广州出库销量    华南地区
  天津出库销量    华北地区
  苏州出库销量    华东地区
  沈阳出库销量    东北地区
  杭州出库销量    华东地区
  dtype: object
  --------------------------------------------------
                   东北地区  华东地区  华北地区  华南地区
  商品名称                                               
  荣耀V40轻奢版         156      1064      1031       578
  OPPO A93               66       405       431       230
  Apple iPhone 11        48       341       370       189
  OPPO K7x               32       258       260       136
  OPPO Reno5             37       203       231       115
  Apple iPhone 12        34       163       148        88
  荣耀X10                29       141       136        81
  Redmi 9                13       122       137        75
  Redmi K30S              9        62        83        51
  OPPOA8                  5        79        66        42
  
  Process finished with exit code 0
  ```

  

## 10. 数据移位

- **df.shift(periods=1, freq=None, axis=0)**

  - periods：表示移动的幅度，可以是正数，也可以是负数，默认值是1，1表示移动一次
  - freq：可选参数，默认值为None，只适用于时间序列，如果这个值存在，那么会按照参数值来移动时间索引，而数据值不会发生变化
  - axis：axis=1表示列，axis=0表示行，默认值为0

  ```python
  import pandas as pd
  data = [7542, 1234, 5246, 2757, 9534]
  index = [1, 2, 3, 4, 5]
  df = pd.DataFrame(data=data, index=index, columns=['OPPO'])
  df['销量差'] = df['OPPO'] - df['OPPO'].shift()
  print("---------------print(df['OPPO'])---------------------")
  print(df['OPPO'])
  print("-------------print(df['OPPO'].shift())---------------")
  print(df['OPPO'].shift())
  print("---df['销量差'] = df['OPPO'] - df['OPPO'].shift()-----")
  print(df)
  
  #result
  ---------------print(df['OPPO'])---------------------
  1    7542
  2    1234
  3    5246
  4    2757
  5    9534
  Name: OPPO, dtype: int64
  -------------print(df['OPPO'].shift())---------------
  1       NaN
  2    7542.0
  3    1234.0
  4    5246.0
  5    2757.0
  Name: OPPO, dtype: float64
  ---df['销量差'] = df['OPPO'] - df['OPPO'].shift()-----
     OPPO     销量差
  1  7542     NaN
  2  1234 -6308.0
  3  5246  4012.0
  4  2757 -2489.0
  5  9534  6777.0
  
  Process finished with exit code 0
  ```

  

## 11. 数据转换

### 11.1 一列数据转成多列数据

- **Series.str.split(pat=None, n=-1, expand=False)**
  - pat：字符串、符号或正则表达式，表示字符串分隔的数据，默认以空格分割字符串
  - n：整型、分割次数、默认值是-1。0或-1都将返回所有拆分的字符串
  - expand：布尔型，分割后的结果是否转换为DataFrame，默认是False

```python
import pandas as pd
pd.set_option('display.unicode.east_asian_width', True)
pd.set_option('display.max_columns', 500)
pd.set_option('display.width', 1000)
df = pd.read_excel('./datas/快递发货单.xlsx', usecols=['客户名称', '快递地址'])
print(df.head())
new_df = df['快递地址'].str.split(' ', expand=True)
print("------new_df = df['快递地址'].str.split(' ', expand=True)-------")
print(new_df)
df['省'] = new_df[0]
df['市'] = new_df[1]
df['区县'] = new_df[2]
df['街道'] = new_df[3]
print(df)

#result
  客户名称                                          快递地址
0   李明玉  陕西省 西安市 长安中路888号 西安音乐学院教研中心
1   张凤香                河北省 唐山市 乐亭县 财富大街990号
2   王红军   上海市 浦东‭新区 快乐路867 快乐城市1111号8808室
3     牛犇                  河北省 唐山市 开发区 喜庆道100号
4     马明                  台湾省 台北市 开发区 经济路101号
------new_df = df['快递地址'].str.split(' ', expand=True)-------
        0          1              2                        3
0  陕西省     西安市  长安中路888号     西安音乐学院教研中心
1  河北省     唐山市         乐亭县            财富大街990号
2  上海市  浦东‭新区      快乐路867     快乐城市1111号8808室
3  河北省     唐山市         开发区              喜庆道100号
4  台湾省     台北市         开发区              经济路101号
5  湖北省     武汉市         青山区   建设1路特新东方大厦802
6  辽宁省     抚顺市         顺城区  太重阳北路1号楼2单元606
7  山东省     临沂市         河东区   正阳北路国科石油分公司
8  山西省     大同市           城区           吉安里75#9-3-2
  客户名称                                          快递地址      省         市           区县                     街道
0   李明玉  陕西省 西安市 长安中路888号 西安音乐学院教研中心  陕西省     西安市  长安中路888号     西安音乐学院教研中心
1   张凤香                河北省 唐山市 乐亭县 财富大街990号  河北省     唐山市         乐亭县            财富大街990号
2   王红军   上海市 浦东‭新区 快乐路867 快乐城市1111号8808室  上海市  浦东‭新区      快乐路867     快乐城市1111号8808室
3     牛犇                  河北省 唐山市 开发区 喜庆道100号  河北省     唐山市         开发区              喜庆道100号
4     马明                  台湾省 台北市 开发区 经济路101号  台湾省     台北市         开发区              经济路101号
5     张刚       湖北省 武汉市 青山区 建设1路特新东方大厦802  湖北省     武汉市         青山区   建设1路特新东方大厦802
6   吴尹明      辽宁省 抚顺市 顺城区 太重阳北路1号楼2单元606  辽宁省     抚顺市         顺城区  太重阳北路1号楼2单元606
7   欧阳丽       山东省 临沂市 河东区 正阳北路国科石油分公司  山东省     临沂市         河东区   正阳北路国科石油分公司
8   佐成明                 山西省 大同市 城区 吉安里75#9-3-2  山西省     大同市           城区           吉安里75#9-3-2
```



### 11.2 将元组数据进行分割

```python
import pandas as pd
data = {
    'a': [1, 2, 3, 4, 5],
    'b': [(1, 2), (2, 3), (3, 4), (5, 6), (7, 8)]
}
df = pd.DataFrame(data=data)
print(df)
df[['b1', 'b2']] = df['b'].apply(pd.Series)
print("---------df[['b1', 'b2']] = df['b'].apply(pd.Series)---------")
print(df)
print("------------df = df.join(df['b'].apply(pd.Series))------------")
df = df.join(df['b'].apply(pd.Series))
print(df)

#result
   a       b
0  1  (1, 2)
1  2  (2, 3)
2  3  (3, 4)
3  4  (5, 6)
4  5  (7, 8)
---------df[['b1', 'b2']] = df['b'].apply(pd.Series)---------
   a       b  b1  b2
0  1  (1, 2)   1   2
1  2  (2, 3)   2   3
2  3  (3, 4)   3   4
3  4  (5, 6)   5   6
4  5  (7, 8)   7   8
------------df = df.join(df['b'].apply(pd.Series))------------
   a       b  b1  b2  0  1
0  1  (1, 2)   1   2  1  2
1  2  (2, 3)   2   3  2  3
2  3  (3, 4)   3   4  3  4
3  4  (5, 6)   5   6  5  6
4  5  (7, 8)   7   8  7  8

Process finished with exit code 0
```

### 11.3 行列转换

- **stack()将原来的列索引转换成最内层的行索引**

  ```python
  import pandas as pd
  pd.set_option('display.unicode.east_asian_width', True)
  df = pd.read_excel('./datas/grade.xlsx')
  print(df.head(8))
  print("------df = df.set_index(['班级', '序号'])--------")
  df = df.set_index(['班级', '序号'])
  print(df.head(8))
  print("---------------df = df.stack()-----------------")
  df = df.stack()
  print(df.head(8))
  
  #result
     序号 班级   姓名  得分  排名
  0     1  1班  王*亮    84    11
  1     2  1班   杨**    82    17
  2     3  1班  王*彬    78    37
  3     4  2班  赛*琪    77    51
  4     5  2班   刘**    76    64
  5     6  2班  刘*彤    74    89
  6     7  3班  张*扬    72   115
  7     8  3班   尹**    72   115
  ------df = df.set_index(['班级', '序号'])--------
              姓名  得分  排名
  班级 序号                   
  1班  1     王*亮    84    11
       2      杨**    82    17
       3     王*彬    78    37
  2班  4     赛*琪    77    51
       5      刘**    76    64
       6     刘*彤    74    89
  3班  7     张*扬    72   115
       8      尹**    72   115
  ---------------df = df.stack()-----------------
  班级  序号    
  1班   1     姓名    王*亮
              得分       84
              排名       11
        2     姓名     杨**
              得分       82
              排名       17
        3     姓名    王*彬
              得分       78
  dtype: object
  
  Process finished with exit code 0
  ```

  

- **unstack()将最内层的行索引转换成列索引**

  ```python
  import pandas as pd
  pd.set_option('display.unicode.east_asian_width', True)
  df = pd.read_excel('./datas/grade2.xls', sheet_name='英语2')
  df = df.set_index(['班级', '序号', 'Unnamed: 2'])
  print(df.head(8))
  print("----------------df.unstack().head(8)-------------------")
  print(df.unstack().head(8))
  
  #result
                       Unnamed: 3
  班级 序号 Unnamed: 2           
  1班  1    姓名            王*亮
            得分               84
            排名               11
       2    姓名             杨**
            得分               82
            排名               17
       3    姓名            王*彬
            得分               78
  ----------------df.unstack().head(8)-------------------
             Unnamed: 3          
  Unnamed: 2       姓名 得分 排名
  班级 序号                      
  1班  1          王*亮   84   11
       2           杨**   82   17
       3          王*彬   78   37
  2班  4          赛*琪   77   51
       5           刘**   76   64
       6          刘*彤   74   89
  
  Process finished with exit code 0
  ```

- **df.pivot(index=None, columns=None, values=None)**

  ```python
  import pandas as pd
  pd.set_option('display.unicode.east_asian_width', True)
  df = pd.read_excel('./datas/grade3.xlsx')
  print(df)
  print("-----print(df.pivot(index='序号', columns='班级', values='得分'))-----")
  print(df.pivot(index='序号', columns='班级', values='得分'))
  
  #result
      序号 班级   姓名  得分  排名
  0      1  1班  王*亮    84    11
  1      2  1班   杨**    82    17
  2      3  1班  王*彬    78    37
  3      1  2班  赛*琪    77    51
  4      2  2班   刘**    76    64
  5      3  2班  刘*彤    74    89
  6      1  3班  张*扬    72   115
  7      2  3班   尹**    72   115
  8      3  3班  李*旸    72   115
  9      1  4班  *华煦    72   115
  10     2  4班  于*明    72   115
  11     3  4班  袁*皓    70   151
  12     1  5班    姜*    70   151
  13     2  5班   窦**    68   195
  14     3  5班  张*昕    68   195
  -----print(df.pivot(index='序号', columns='班级', values='得分'))-----
  班级  1班  2班  3班  4班  5班
  序号                         
  1      84   77   72   72   70
  2      82   76   72   72   68
  3      78   74   72   70   68
  
  Process finished with exit code 0
  ```

  

### 11.4 DataFrame转换为字典、列表和元组等等

- 转换成字典：df.to_dic()

  ```python
  import pandas as pd
  pd.set_option('display.unicode.east_asian_width', True)
  df = pd.read_excel('./datas/电脑配件销售记录.xlsx')
  print(df.head())
  print("------mydict = df.groupby('产品名称')['数量'].sum()--------")
  df1 = df.groupby('产品名称')['数量'].sum()
  print(df1)
  mydict = df1.to_dict()
  print('---------mydict = df1.to_dict()------------')
  print(mydict)
  
  #result
     产品名称  销售员  数量  标准单价  成交金额
  0  无线网卡    王丽    10       178      1780
  1  无线网卡  李桂林    30       178      5340
  2      鼠标    李欢     6       299      1794
  3      鼠标    李欢    15       299      4485
  4      鼠标  李桂林    16       299      4784
  ------mydict = df.groupby('产品名称')['数量'].sum()--------
  产品名称
  DVD光驱       150
  SD存储卡       44
  手写板         57
  无线网卡       40
  蓝牙适配器    322
  键盘          140
  麦克风        178
  鼠标          166
  Name: 数量, dtype: int64
  {'DVD光驱': 150, 'SD存储卡': 44, '手写板': 57, '无线网卡': 40, '蓝牙适配器': 322, '键盘': 140, '麦克风': 178, '鼠标': 166}
  
  Process finished with exit code 0
  ```

  

- 转换成列表：df.to_list()

  ```python
  import pandas as pd
  pd.set_option('display.unicode.east_asian_width', True)
  df = pd.read_excel('./datas/电脑配件销售记录.xlsx')
  print(df.head())
  print("----------df1 = df['产品名称']-------------")
  df1 = df['产品名称']
  print(df1.head())
  print("---------lst = df1.to_list()------------")
  lst = df1.to_list()
  print(lst)
  
  #result
     产品名称  销售员  数量  标准单价  成交金额
  0  无线网卡    王丽    10       178      1780
  1  无线网卡  李桂林    30       178      5340
  2      鼠标    李欢     6       299      1794
  3      鼠标    李欢    15       299      4485
  4      鼠标  李桂林    16       299      4784
  ----------df1 = df['产品名称']-------------
  0    无线网卡
  1    无线网卡
  2        鼠标
  3        鼠标
  4        鼠标
  Name: 产品名称, dtype: object
  ---------lst = df1.to_list()------------
  ['无线网卡', '无线网卡', '鼠标', '鼠标', '鼠标', '鼠标', '鼠标', '手写板', '手写板', '麦克风', '麦克风', '麦克风', '麦克风', '麦克风', '蓝牙适配器', '蓝牙适配器', '蓝牙适配器', '蓝牙适配器', '蓝牙适配器', '蓝牙适配器', '键盘', '键盘', 'SD存储卡', 'SD存储卡', 'SD存储卡', 'DVD光驱', 'DVD光驱', 'DVD光驱', 'DVD光驱']
  
  Process finished with exit code 0
  ```

  

- 转换成元组

  ```python
  import pandas as pd
  pd.set_option('display.unicode.east_asian_width', True)
  df = pd.read_excel('./datas/电脑配件销售记录.xlsx')
  print(df.head())
  df1 = df[['产品名称', '销售员', '数量']]
  print("---------df1 = df[['产品名称', '销售员', '数量']]----------")
  print(df1.head())
  print(df1.head().values)
  t = [tuple(x) for x in df1.values]
  for item in t:
      print(item)
      
  #result
     产品名称  销售员  数量  标准单价  成交金额
  0  无线网卡    王丽    10       178      1780
  1  无线网卡  李桂林    30       178      5340
  2      鼠标    李欢     6       299      1794
  3      鼠标    李欢    15       299      4485
  4      鼠标  李桂林    16       299      4784
  ---------df1 = df[['产品名称', '销售员', '数量']]----------
     产品名称  销售员  数量
  0  无线网卡    王丽    10
  1  无线网卡  李桂林    30
  2      鼠标    李欢     6
  3      鼠标    李欢    15
  4      鼠标  李桂林    16
  [['无线网卡' '王丽' 10]
   ['无线网卡' '李桂林' 30]
   ['鼠标' '李欢' 6]
   ['鼠标' '李欢' 15]
   ['鼠标' '李桂林' 16]]
  ('无线网卡', '王丽', 10)
  ('无线网卡', '李桂林', 30)
  ('鼠标', '李欢', 6)
  ('鼠标', '李欢', 15)
  ('鼠标', '李桂林', 16)
  ('鼠标', '王双', 52)
  ('鼠标', '李桂林', 77)
  ('手写板', '华国华', 14)
  ('手写板', '王丽', 43)
  ('麦克风', '王丽', 4)
  ('麦克风', '王丽', 10)
  ('麦克风', '华国华', 47)
  ('麦克风', '李桂林', 55)
  ('麦克风', '李欢', 62)
  ('蓝牙适配器', '李桂林', 18)
  ('蓝牙适配器', '李桂林', 39)
  ('蓝牙适配器', '王丽', 51)
  ('蓝牙适配器', '李桂林', 58)
  ('蓝牙适配器', '李桂林', 61)
  ('蓝牙适配器', '李欢', 95)
  ('键盘', '华国华', 20)
  ('键盘', '王丽', 120)
  ('SD存储卡', '李欢', 9)
  ('SD存储卡', '李桂林', 15)
  ('SD存储卡', '李桂林', 20)
  ('DVD光驱', '王丽', 30)
  ('DVD光驱', '王丽', 32)
  ('DVD光驱', '华国华', 40)
  ('DVD光驱', '华国华', 48)
  
  Process finished with exit code 0
  ```

  

- 转换成HTML：df.to_html()

  ```python
  import pandas as pd
  pd.set_option('display.unicode.east_asian_width', True)
  df = pd.read_excel('./datas/电脑配件销售记录.xlsx')
  df.to_html('电脑配件销售记录.html', header=True, index=False)
  ```

  

## 12. 数据合并

### 12.1 merge()方法

- **pd.merge(right, how='inner', on=None, left_on=None, right_on=None)**
  - right：合并对象，DataFrame或Series
  - how：合并类型，参数值可以是left、right、outer或inner
    - left：以左边的表为基准
    - right：以右边的表为基准
    - outer：合并所有的数据，没有的数据填写NaN
    - inner：只合并数据齐全的项，有数据不全的项直接丢弃
  - on：标签、列表或数组
  - left_on：标签、列表或数组
  - right_on：标签、列表或数组

#### 12.1.1 通过相同的列合并

```python
import pandas as pd
pd.set_option('display.unicode.east_asian_width', True)
df1 = pd.read_excel('./datas/student1.xlsx')
df2 = pd.read_excel('./datas/student2.xlsx')
print(df1)
print(df2)
new_df = pd.merge(df1, df2, on='编号')
print(new_df)

#result
      编号  语文  数学  英语
0  msb1001   145   150   134
1  msb1002   146   145   143
2  msb1003   150   134   135
      编号  体育
0  msb1001  35.4
1  msb1002  23.5
2  msb1003  45.5
      编号  语文  数学  英语  体育
0  msb1001   145   150   134  35.4
1  msb1002   146   145   143  23.5
2  msb1003   150   134   135  45.5

Process finished with exit code 0
```

#### 12.1.2 通过索引列合并

```python
import pandas as pd
pd.set_option('display.unicode.east_asian_width', True)
df1 = pd.read_excel('./datas/student1.xlsx')
df2 = pd.read_excel('./datas/student2.xlsx')
print(df1)
print(df2)

new_df1 = pd.merge(df1, df2, how='left', on='编号')
new_df2 = pd.merge(df1, df2, how='right', on='编号')
new_df3 = pd.merge(df1, df2, how='inner', on='编号')
new_df4 = pd.merge(df1, df2, how='outer', on='编号')

print("------new_df1 = pd.merge(df1, df2, how='left', on='编号')------")
print(new_df1)
print("------new_df2 = pd.merge(df1, df2, how='right', on='编号')------")
print(new_df2)
print("------new_df3 = pd.merge(df1, df2, how='inner', on='编号')------")
print(new_df3)
print("------new_df4 = pd.merge(df1, df2, how='outer', on='编号')------")
print(new_df4)
```

#### 12.1.2 多对一合并

```python
import pandas as pd
df1 = pd.DataFrame({
        '编号': ['msb1001', 'msb1002', 'msb1003'],
        '姓名': ['张三', '李四', '王五']
})
df2 = pd.DataFrame({
    '编号': ['msb1001', 'msb1001', 'msb1003'],
    '语文': [145, 134, 146],
    '数学': [149, 132, 150],
    '英语': [123, 134, 143],
    '月份': ['1月', '2月', '1月']
})
print(df1)
print(df2)
print("------------------多对一的数据合并-------------------------")
print("--------new_df = pd.merge(df1, df2, on='编号')-----------")
new_df = pd.merge(df1, df2, on='编号')
print(new_df)

#result
        编号  姓名
0  msb1001  张三
1  msb1002  李四
2  msb1003  王五
        编号   语文   数学   英语  月份
0  msb1001  145  149  123  1月
1  msb1001  134  132  134  2月
2  msb1003  146  150  143  1月
        编号  姓名   语文   数学   英语  月份
0  msb1001  张三  145  149  123  1月
1  msb1001  张三  134  132  134  2月
2  msb1003  王五  146  150  143  1月

Process finished with exit code 0
```

#### 12.1.3. 多对多合并

```python
import pandas as pd
df1 = pd.DataFrame({
        '编号': ['msb1001', 'msb1002', 'msb1003', 'msb1003', 'msb1003'],
        '语文': [145, 134, 143, 145, 147]
})
df2 = pd.DataFrame({
    '编号': ['msb1001', 'msb1002', 'msb1003', 'msb1001', 'msb1001'],
    '体育': [12, 43, 132, 432, 53],
})
print(df1)
print(df2)
new_df = pd.merge(df1, df2)
print('-----------new_df = pd.merge(df1, df2)--------')
print(new_df)

#result
        编号   语文
0  msb1001  145
1  msb1002  134
2  msb1003  143
3  msb1003  145
4  msb1003  147
        编号   体育
0  msb1001   12
1  msb1002   43
2  msb1003  132
3  msb1001  432
4  msb1001   53
-----------new_df = pd.merge(df1, df2)--------
        编号   语文   体育
0  msb1001  145   12
1  msb1001  145  432
2  msb1001  145   53
3  msb1002  134   43
4  msb1003  143  132
5  msb1003  145  132
6  msb1003  147  132

Process finished with exit code 0
```



### 12.2 concat()方法

- **pd.concat(objs, axis=0, join='outer', ignore_index=False, keys=None)**
  - objs：Series、DataFrame的对象等
  - axis：axis=1表示行、axis=0表示列，默认为0
  - join：值为inner(交集)或outer(并集)，默认为outer
  - ignore_index：默认为Flase，保留行索引，如果不保留行索引，则为True
  - keys：使用传递的键作为最外层构建层次索引

#### 12.2.1 纵向合并

```python
import pandas as pd
df1 = pd.read_excel('./datas/数据合并concat.xlsx', sheet_name='Sheet1')
df2 = pd.read_excel('./datas/数据合并concat.xlsx', sheet_name='Sheet2')
df3 = pd.read_excel('./datas/数据合并concat.xlsx', sheet_name='Sheet3')
print(df1)
print(df2)
print(df3)

print('---------------df = pd.concat([df1, df2, df3])---------------------')
df = pd.concat([df1, df2, df3])
print(df)

print("-------df = pd.concat([df1, df2, df3],keys=['表1', '表2', '表3'])----------")
df = pd.concat([df1, df2, df3],keys=['表1', '表2', '表3'])
print(df)

print("--------df = pd.concat([df1, df2, df3], ignore_index=True)---------------")
df = pd.concat([df1, df2, df3], ignore_index=True)
print(df)

#result
    A   B   C   D
0  11  22  33  44
1  12  23  34  45
    A   B    C   D
0  99  88   77  66
1  55  44   33  22
2  11  23  345  35
     A    B    C    D
0  333  222  444  555
---------------df = pd.concat([df1, df2, df3])---------------------
     A    B    C    D
0   11   22   33   44
1   12   23   34   45
0   99   88   77   66
1   55   44   33   22
2   11   23  345   35
0  333  222  444  555
-------df = pd.concat([df1, df2, df3],keys=['表1', '表2', '表3'])----------
        A    B    C    D
表1 0   11   22   33   44
   1   12   23   34   45
表2 0   99   88   77   66
   1   55   44   33   22
   2   11   23  345   35
表3 0  333  222  444  555
--------df = pd.concat([df1, df2, df3], ignore_index=True)---------------
     A    B    C    D
0   11   22   33   44
1   12   23   34   45
2   99   88   77   66
3   55   44   33   22
4   11   23  345   35
5  333  222  444  555

Process finished with exit code 0
```





#### 12.2.2 横向合并

```python
import pandas as pd
df1 = pd.read_excel('./datas/数据合并concat.xlsx', sheet_name='Sheet1')
df2 = pd.read_excel('./datas/数据合并concat.xlsx', sheet_name='Sheet4')
print(df1)
print(df2)
df = pd.concat([df1, df2], axis=1)
print(df)

#result
    A   B   C   D
0  11  22  33  44
1  12  23  34  45
        D       E        F
0      44  world1  python1
1      45  world2  python2
2  hello3  world3  python3
3  hello4  world4  python4
4  hello5  world5  python5
      A     B     C     D       D       E        F
0  11.0  22.0  33.0  44.0      44  world1  python1
1  12.0  23.0  34.0  45.0      45  world2  python2
2   NaN   NaN   NaN   NaN  hello3  world3  python3
3   NaN   NaN   NaN   NaN  hello4  world4  python4
4   NaN   NaN   NaN   NaN  hello5  world5  python5

Process finished with exit code 0
```



#### 12.2.3 交叉合并

```python
import pandas as pd
df1 = pd.read_excel('./datas/数据合并concat.xlsx', sheet_name='Sheet1')
df2 = pd.read_excel('./datas/数据合并concat.xlsx', sheet_name='Sheet4')
print(df1)
print(df2)
df = pd.concat([df1, df2], axis=1, join='inner')
print(df)

#result
    A   B   C   D
0  11  22  33  44
1  12  23  34  45
        D       E        F
0      44  world1  python1
1      45  world2  python2
2  hello3  world3  python3
3  hello4  world4  python4
4  hello5  world5  python5
    A   B   C   D   D       E        F
0  11  22  33  44  44  world1  python1
1  12  23  34  45  45  world2  python2

Process finished with exit code 0
```

## 13. 数据导出

### 13.1 导出数据为Excel文件

- **df.to_excel()**

  ```python
  import pandas as pd
  df = pd.DataFrame({
      '编号': ['1001', '1002', '1003'],
      '姓名': ['张三', '李四', '王五']
  })
  df.to_excel('./datas/数据导出-学员信息数据.xlsx', index=False, sheet_name='学生信息')
  ```

### 13.2 导出到多个Sheet页中

```python
import pandas as pd
df = pd.DataFrame({
    '编号': ['1001', '1002', '1003'],
    '姓名': ['张三', '李四', '王五'],
    '总成绩': [300, 240, 310]
})
# 打开一个Excel文件
work = pd.ExcelWriter('./datas/数据导出———多.xlsx')
df.to_excel(work, index=False, sheet_name='学生信息')
df[['姓名', '总成绩']].to_excel(work, index=False, sheet_name='成绩表')
work.save()
```



### 13.3 导出数据为CSV文件

- **df.to_csv(path_or_buf, sep=',', float_format=None, header=True, index=True)**
  - path_or_buf：要保存的路径及文件名
  - sep：分隔符，默认为逗号
  - float_format：浮点数的输出格式
  - columns：指定要导出的列，用列名、列表表示，默认为None
  - header：是否输出列名，默认值为True
  - index：是否输出索引，默认值为True

```python
import pandas as pd
df = pd.DataFrame({
    '编号': ['1001', '1002', '1003'],
    '姓名': ['张三', '李四', '王五'],
    '总成绩': [300, 240, 310]
})
df.to_csv('./datas/数据导出-学生数据.csv', index=False, columns=['姓名', '总成绩'], float_format='%.2f')
```



## 14. 日期数据处理

### 14.1 日期格式的转换

- **pd.to_datatime(arg, errors='ignore', dayfirst=False, yearfirst=False, format=None)**

  - arg：字符串，日期时间，字符串数组
  - errors：值为ignore、raise、coerce，默认值为ignore忽略错误
    - ignore：无效的解析将返回原值
    - raise：无效的解析将引发异常
    - coerce：无效的解析将被设置为NaT，即无法转换为日期的数据转换为NaT

  - dayfirst：第一个为天，默认值为False，02/09/2020，如果值为True，则为

  - yearfirst：第一个为年，默认值为False

  - format：格式化显示时间的格式，字符串，默认值为None

    

- 转换时间格式

```python
import pandas as pd
df = pd.DataFrame({
    '原日期': ['14-Feb-20', '02/14/2020', '2020.02.14', '20200214', '2020-02-14'],
})
pd.set_option('display.unicode.east_asian_width', True)
print("-------df['转换后的日期'] = pd.to_datetime(df['原日期'])----------")
df['转换后的日期'] = pd.to_datetime(df['原日期'])
print(df)

#result
       原日期 转换后的日期
0   14-Feb-20   2020-02-14
1  02/14/2020   2020-02-14
2  2020.02.14   2020-02-14
3    20200214   2020-02-14
4  2020-02-14   2020-02-14

Process finished with exit code 0
```

- 组合时间

```python
import pandas as pd
df = pd.DataFrame({
    'year': [2018, 2019, 2020],
    'month': [1, 2, 3],
    'day': [10, 20, 30],
    'hour': [13, 14, 15],
    'minute': [19, 20, 30],
    'second': [9, 20, 45]
})
pd.set_option('display.unicode.east_asian_width', True)
print("-------df['组合后的日期'] = pd.to_datetime(df)----------")
print("这种组合，年必须是year，月必须是month，日必须是day")
df['组合后的日期'] = pd.to_datetime(df)
print(df)

#result
-------df['组合后的日期'] = pd.to_datetime(df)----------
这种组合，年必须是year，月必须是month，日必须是day
   year  month  day  hour  minute  second        组合后的日期
0  2018      1   10    13      19       9 2018-01-10 13:19:09
1  2019      2   20    14      20      20 2019-02-20 14:20:20
2  2020      3   30    15      30      45 2020-03-30 15:30:45

Process finished with exit code 0
```



### 14.2 dt对象的使用

- dt对象的属性和方法

  - year、month、day、dayofweek
  - dayofyear、is_leap_year、quarter、weekday_name

  ```python
  import pandas as pd
  df = pd.read_excel('./datas/原日期.xlsx')
  pd.set_option('display.unicode.east_asian_width', True)
  df['日期'] = pd.to_datetime(df['原日期'])
  print(df)
  print('type(df["日期"]) = ', type(df['日期']))
  print('-'*20 + "提取年" + '-'*20)
  print('-'*15 + "df['年'] = df['日期'].dt.year" + '-'*15)
  df['年'] = df['日期'].dt.year
  print(df)
  print('-'*20 + "提取月" + '-'*20)
  print('-'*15 + "df['月'] = df['日期'].dt.month" + '-'*15)
  df['月'] = df['日期'].dt.month
  print(df)
  print('-'*20 + "提取日" + '-'*20)
  print('-'*15 + "df['日'] = df['日期'].dt.day" + '-'*15)
  df['日'] = df['日期'].dt.day
  print(df)
  print('-'*20 + "提取星期" + '-'*20)
  print('-'*15 + "df['星期'] = df['日期'].dt.day_name()" + '-'*15)
  df['星期'] = df['日期'].dt.day_name()
  print(df)
  print('-'*20 + "提取季度" + '-'*20)
  print('-'*15 + "df['季度'] = df['日期'].dt.quarter" + '-'*15)
  df['季度'] = df['日期'].dt.quarter
  print(df)
  print('-'*20 + "是否是年底" + '-'*20)
  print('-'*15 + "df['是否是年底'] = df['日期'].dt.is_year_end" + '-'*15)
  df['是否是年底'] = df['日期'].dt.is_year_end
  print(df)
  
  #result
         原日期       日期
  0   2020.1.12 2020-01-12
  1   2020.6.15 2020-06-15
  2   2020.7.14 2020-07-14
  3  2020.12.31 2020-12-31
  4   2021.1.16 2021-01-16
  5   2021.2.14 2021-02-14
  6   2021.3.18 2021-03-18
  7   2021.4.24 2021-04-24
  type(df["日期"]) =  <class 'pandas.core.series.Series'>
  --------------------提取年--------------------
  ---------------df['年'] = df['日期'].dt.year---------------
         原日期       日期    年
  0   2020.1.12 2020-01-12  2020
  1   2020.6.15 2020-06-15  2020
  2   2020.7.14 2020-07-14  2020
  3  2020.12.31 2020-12-31  2020
  4   2021.1.16 2021-01-16  2021
  5   2021.2.14 2021-02-14  2021
  6   2021.3.18 2021-03-18  2021
  7   2021.4.24 2021-04-24  2021
  --------------------提取月--------------------
  ---------------df['月'] = df['日期'].dt.month---------------
         原日期       日期    年  月
  0   2020.1.12 2020-01-12  2020   1
  1   2020.6.15 2020-06-15  2020   6
  2   2020.7.14 2020-07-14  2020   7
  3  2020.12.31 2020-12-31  2020  12
  4   2021.1.16 2021-01-16  2021   1
  5   2021.2.14 2021-02-14  2021   2
  6   2021.3.18 2021-03-18  2021   3
  7   2021.4.24 2021-04-24  2021   4
  --------------------提取日--------------------
  ---------------df['日'] = df['日期'].dt.day---------------
         原日期       日期    年  月  日
  0   2020.1.12 2020-01-12  2020   1  12
  1   2020.6.15 2020-06-15  2020   6  15
  2   2020.7.14 2020-07-14  2020   7  14
  3  2020.12.31 2020-12-31  2020  12  31
  4   2021.1.16 2021-01-16  2021   1  16
  5   2021.2.14 2021-02-14  2021   2  14
  6   2021.3.18 2021-03-18  2021   3  18
  7   2021.4.24 2021-04-24  2021   4  24
  --------------------提取星期--------------------
  ---------------df['星期'] = df['日期'].dt.day_name()---------------
         原日期       日期    年  月  日      星期
  0   2020.1.12 2020-01-12  2020   1  12    Sunday
  1   2020.6.15 2020-06-15  2020   6  15    Monday
  2   2020.7.14 2020-07-14  2020   7  14   Tuesday
  3  2020.12.31 2020-12-31  2020  12  31  Thursday
  4   2021.1.16 2021-01-16  2021   1  16  Saturday
  5   2021.2.14 2021-02-14  2021   2  14    Sunday
  6   2021.3.18 2021-03-18  2021   3  18  Thursday
  7   2021.4.24 2021-04-24  2021   4  24  Saturday
  --------------------提取季度--------------------
  ---------------df['季度'] = df['日期'].dt.quarter---------------
         原日期       日期    年  月  日      星期  季度
  0   2020.1.12 2020-01-12  2020   1  12    Sunday     1
  1   2020.6.15 2020-06-15  2020   6  15    Monday     2
  2   2020.7.14 2020-07-14  2020   7  14   Tuesday     3
  3  2020.12.31 2020-12-31  2020  12  31  Thursday     4
  4   2021.1.16 2021-01-16  2021   1  16  Saturday     1
  5   2021.2.14 2021-02-14  2021   2  14    Sunday     1
  6   2021.3.18 2021-03-18  2021   3  18  Thursday     1
  7   2021.4.24 2021-04-24  2021   4  24  Saturday     2
  --------------------是否是年底--------------------
  ---------------df['是否是年底'] = df['日期'].dt.quarter---------------
         原日期       日期    年  月  日      星期  季度  是否是年底
  0   2020.1.12 2020-01-12  2020   1  12    Sunday     1       False
  1   2020.6.15 2020-06-15  2020   6  15    Monday     2       False
  2   2020.7.14 2020-07-14  2020   7  14   Tuesday     3       False
  3  2020.12.31 2020-12-31  2020  12  31  Thursday     4        True
  4   2021.1.16 2021-01-16  2021   1  16  Saturday     1       False
  5   2021.2.14 2021-02-14  2021   2  14    Sunday     1       False
  6   2021.3.18 2021-03-18  2021   3  18  Thursday     1       False
  7   2021.4.24 2021-04-24  2021   4  24  Saturday     2       False
  
  Process finished with exit code 0
  ```

  

### 14.3 获取日期区间的数据

- 获取某年数据 df[year]
- 获取两个年份间的数据 df[year1, year2]
- 获取某月的数据 df[year-month]
- 获取具体某天的数据 df[日期1: 日期1]

















# 二、 matplotlib

## 1. 导入模块

```python
from matplotlib import pyplot as plt
```

## 2. 画布和坐标轴设置

### 2.1 设置画布大小和背景

**plt.figure(num=None, figsize=None, dpi=None, facecolor=None,edgecolor=None, frameon=True)**

- num:画布编号或名称，数字为编号 ，字符串为名称
- figsize:指定figure的宽和高，单位为英寸，一般用元组传递 (宽，高)
- dpi参数指定绘图对象的分辨率，即每英寸多少个像素，缺省值为80，1英寸等于2.5cm,A4纸是 21*30cm的纸张
- facecolor:背景颜色
- edgecolor:边框颜色
- frameon:是否显示边框

### 2.2 设置x和y的坐标范围

**plt.axis([xmin,xmax,ymin,ymax])**

### 2.3 设置y轴坐标范围

**plt.ylim(ymin,ymax)**

### 2.4 设置x轴坐标范围

**plt.xlim(xmin,xmax)**

### 2.5 设置x轴刻度

**plt.xticks()**

### 2.6 设置y轴刻度

**plt.yticks()**

### 2.7 设置图标标题

**plt.title()**

### 2.8 设置图例

**plt.legend(loc)**

### 2.9 显示网格

**plt.gird(alpha)**

### 2.10 保存图片

**plt.savefig()**

## 3. 折线图：气温变化表

```python
import random
from matplotlib import pyplot as plt

#设置字体，默认字体显示不了中文
plt.rcParams['font.family']='MicroSoft YaHei'

x = range(0,120)
y = [random.randint(20,35) for i in range(120)]

# 设置图片大小
plt.figure(figsize=(20,8),dpi=80)
# 设置x轴刻度
_x = list(x)
_xtick_labels = ["10点{}分".format(i) for i in range(60)]
_xtick_labels += ["11点{}分".format(i) for i in range(60)]
# 取步长，数字和字符串一一对应，数据的长度一样
plt.xticks(_x[::3],_xtick_labels[::3],rotation = 45)  #rotation刻度旋转的度数
# 设置y轴刻度
plt.yticks(range(min(y),max(y)+1))

# 添加描述信息
plt.xlabel("时间")
plt.ylabel("温度 单位(°C)")
plt.title("10点到12点每分钟的气温变化情况")

plt.plot(x,y)
plt.show()

# 保存
#plt.savefig('./t1.png')
```



## 3. 子图
